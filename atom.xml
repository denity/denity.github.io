<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä»å°æœ‰ä¸ªå¼€ä¸ªå’–å•¡åº—æ‚ é—²æ— èŠçœ‹åº—å¤–åŒ†åŒ†å¿™å¿™äººæ¥äººå¾€ä¸€è¾¹æ‰“ä»£ç ä¸€è¾¹å–å’–å•¡åƒè›‹ç³•çš„æ¢¦æƒ³</title>
  
  <subtitle>Keep It Simple Stupid</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.sqj.me/"/>
  <updated>2019-11-14T02:10:52.966Z</updated>
  <id>http://blog.sqj.me/</id>
  
  <author>
    <name>Jay Yi</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä½¿ç”¨ lsyncd è¿›è¡Œä¸»ä»æ–‡ä»¶å®æ—¶åŒæ­¥</title>
    <link href="http://blog.sqj.me/2019/replication-with-lsyncd/"/>
    <id>http://blog.sqj.me/2019/replication-with-lsyncd/</id>
    <published>2019-11-14T01:22:53.000Z</published>
    <updated>2019-11-14T02:10:52.966Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰äº›æ–‡ä»¶æ•°æ®è¶…çº§å¤§ï¼Œè¾¾åˆ°Tçš„æ•°é‡çº§ï¼Œå¦‚æœç”¨å¤‡ä»½ç³»ç»Ÿè¿›è¡Œå¤‡ä»½ï¼Œéœ€è¦ä¸Šå‘¨çš„æ—¶é—´ï¼Œè€Œä¸”å¤‡ä»½è¿‡ç¨‹ä¸­æ–‡ä»¶ä¹Ÿåœ¨ä¸æ–­å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´å¤‡ä»½æ–‡ä»¶ä¸å¯æ§ã€‚</p><p>æœ¬æ–‡ä»‹ç»åˆ©ç”¨ lsyncd è¿›è¡Œä¸»ä»æ•°æ®çš„åŒæ—¶å¤‡ä»½ã€‚ lysncd å®é™…ä¸Šæ˜¯luaè¯­è¨€å°è£…äº† inotify å’Œ rsync å·¥å…·ï¼Œé‡‡ç”¨äº† Linux å†…æ ¸ï¼ˆ2.6.13 åŠä»¥åï¼‰é‡Œçš„ inotify è§¦å‘æœºåˆ¶ï¼Œç„¶åé€šè¿‡rsyncå»å·®å¼‚åŒæ­¥ï¼Œè¾¾åˆ°å®æ—¶çš„æ•ˆæœã€‚ </p><p>lsyncd é¡¹ç›®åœ°å€  <a href="https://github.com/axkibe/lsyncd" target="_blank" rel="noopener">https://github.com/axkibe/lsyncd</a>  å®˜ç½‘  <a href="https://axkibe.github.io/lsyncd/" target="_blank" rel="noopener">https://axkibe.github.io/lsyncd/</a> </p></blockquote><h3 id="1-rsyncå®‰è£…"><a href="#1-rsyncå®‰è£…" class="headerlink" title="1. rsyncå®‰è£…"></a>1. rsyncå®‰è£…</h3><p>lsyncd ä¾èµ–äº rsyncï¼Œç°åœ¨ç³»ç»Ÿä¸­å®‰è£… rsync</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install rsync</span><br><span class="line"><span class="comment">#æˆ–è€…</span></span><br><span class="line">yum update rsync</span><br></pre></td></tr></table></figure><h3 id="2-å®‰è£…-repl-yum-æº"><a href="#2-å®‰è£…-repl-yum-æº" class="headerlink" title="2. å®‰è£… repl yum æº"></a>2. å®‰è£… repl yum æº</h3><p>åˆ©ç”¨ epel yum æºï¼Œå¯ç›´æ¥yumå®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br></pre></td></tr></table></figure><h3 id="3-yum-å®‰è£…-lsyncd"><a href="#3-yum-å®‰è£…-lsyncd" class="headerlink" title="3. yum å®‰è£… lsyncd"></a>3. yum å®‰è£… lsyncd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install lsyncd</span><br></pre></td></tr></table></figure><h3 id="4-é…ç½®-etc-lsyncd-conf"><a href="#4-é…ç½®-etc-lsyncd-conf" class="headerlink" title="4. é…ç½® /etc/lsyncd.conf"></a>4. é…ç½® /etc/lsyncd.conf</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-- æ³¨é‡Šæ‰æœ€åä¸€æ ·</span><br><span class="line">-- sync&#123;default.rsyncssh, source="/var/www/html", host="localhost", targetdir="/tmp/htmlcopy/"&#125;</span><br><span class="line"></span><br><span class="line">-- æ·»åŠ  lsyncd é…ç½®ä»£ç </span><br><span class="line">settings &#123;</span><br><span class="line">   logfile    = "/data/lsyncd_log/lsyncd.log",# æ—¥å¿—æ–‡ä»¶</span><br><span class="line">   statusFile = "/data/lsyncd_log/lsyncd.status",# åŒæ­¥æ–‡ä»¶çŠ¶æ€</span><br><span class="line">   insist = true,</span><br><span class="line">   statusInterval = 10,# åŒæ­¥æ—¶é—´é—´éš” 10s</span><br><span class="line">   inotifyMode  = "CloseWrite"# æ–‡ä»¶å˜åŒ–æ£€æµ‹æ¨¡å¼</span><br><span class="line">&#125;</span><br><span class="line">sync &#123;</span><br><span class="line">   default.rsyncssh,</span><br><span class="line">   source="/data/www/XXXX",# åŒæ­¥æœ¬æœºæºåœ°å€</span><br><span class="line">   host="172.19.0.123",# ç›®æ ‡ä¸»æœº</span><br><span class="line">   targetdir="/data/www/xxxx_sync",# ç›®æ ‡ä¸»æœºä¸Šçš„å¤‡ä»½åœ°å€</span><br><span class="line">   rsync = &#123;</span><br><span class="line">     archive = true,</span><br><span class="line">     compress = false,# æ˜¯å¦å‹ç¼©ï¼Œå‹ç¼©ä¼šå¥½ç”¨æœ¬æœºCPUï¼ŒæŒ‰å®é€‰æ‹©</span><br><span class="line">     whole_file = false</span><br><span class="line">   &#125;,</span><br><span class="line">   ssh = &#123;</span><br><span class="line">     port = 22# ç›®æ ‡ä¸»æœºsshç«¯å£</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‚æ•°è¯´æ˜ï¼š"><a href="#å‚æ•°è¯´æ˜ï¼š" class="headerlink" title="å‚æ•°è¯´æ˜ï¼š"></a>å‚æ•°è¯´æ˜ï¼š</h4><p><strong>inotifyModeï¼š</strong>æŒ‡å®šinotifyç›‘æ§çš„æ¨¡å¼ï¼Œé»˜è®¤æ˜¯CloseWriteï¼Œå¯é…ç½®ä¸ºModifyæˆ–CloseWrite or Modifyã€‚</p><p>CloseWriteå¦‚å­—é¢æ„æ€ï¼Œå°±æ˜¯ç»“æŸå†™å…¥ã€‚ Modifyåˆ™æ˜¯ç›‘æ§æ–‡ä»¶çš„å˜æ›´ã€‚</p><p><strong>maxProcesses:</strong> åŒæ­¥æ—¶æœ€å¤§çš„è¿›ç¨‹æ•°ï¼Œåœ¨rsyncsshæ¨¡å¼ä¸‹ï¼ŒmaxProcesses=1ï¼Œå¯ä¸è®¾ç½®ã€‚ </p><p><strong>syncæ¨¡å¼ï¼š</strong></p><ol><li><p>æœ¬åœ°ç›®å½•åŒæ­¥ï¼ˆ direct ï¼‰  default.direct </p></li><li><p>æœ¬åœ°ç›®å½•åŒæ­¥ï¼ˆ  rsync  ï¼‰  default. rsync </p></li><li><p>è¿œç¨‹ç›®å½•åŒæ­¥ï¼ˆrsync + rsyncd daemon ï¼‰</p><p>default.rsync </p><p>target = â€œ<a href="mailto:syncuser@172.19.0.123" target="_blank" rel="noopener">syncuser@172.19.0.123</a>::module1â€ </p></li><li><p>è¿œç¨‹ç›®å½•åŒæ­¥ï¼ˆrsync + ssh shell ï¼‰ï¼Œä¹Ÿå°±æ˜¯æœ¬æ–‡æ‰€ç”¨æ¨¡å¼ï¼Œo(<em>ï¿£ï¸¶ï¿£</em>)o</p><p>default.rsyncssh </p></li></ol><h3 id="5-é…ç½®è¿œç¨‹SSHå…å¯†ç™»å½•"><a href="#5-é…ç½®è¿œç¨‹SSHå…å¯†ç™»å½•" class="headerlink" title="5. é…ç½®è¿œç¨‹SSHå…å¯†ç™»å½•"></a>5. é…ç½®è¿œç¨‹SSHå…å¯†ç™»å½•</h3><p>é…ç½®å®Œ lsyncd åï¼Œéœ€è¦å…è®¸æœ¬æœºè¿œç¨‹å…å¯†ç™»å½•è¿œç¨‹ç›®æ ‡ä¸»æœºã€‚</p><p>5.1 ï¼ˆè¿œç¨‹ç›®æ ‡ä¸»æœºï¼‰ç”Ÿæˆ ssh key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -b 4096 -t rsa</span><br><span class="line"><span class="comment"># ä¸€è·¯å›è½¦ï¼Œç”Ÿæˆ /root/.ssh/id_rsa æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>5.2 ï¼ˆè¿œç¨‹ç›®æ ‡ä¸»æœºï¼‰ç”Ÿæˆ  authorized keys </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line">cat id_rsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure><p>5.3 ï¼ˆæœ¬åœ°ä¸»æœºï¼‰å°†è¿œç¨‹ä¸»æœºçš„ /root/.ssh/id_rsa ï¼ˆ id_rsaç§é’¥ ï¼‰ï¼Œå¤åˆ¶åˆ°æœ¬åœ°ä¸»æœº</p><p>5.4  ï¼ˆæœ¬åœ°ä¸»æœºï¼‰å˜æ›´æ–‡ä»¶æƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure><p>5.5 ï¼ˆæœ¬åœ°ä¸»æœºï¼‰æµ‹è¯•å…å¯†ç™»å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç”¨æˆ·å userï¼Œipï¼Œç«¯å£ æ ¹æ®å®é™…æƒ…å†µé…ç½®</span></span><br><span class="line">ssh user@172.19.0.123 -p 22</span><br></pre></td></tr></table></figure><h3 id="6-å¯ç”¨-lsyncd-åŒæ­¥-æœåŠ¡"><a href="#6-å¯ç”¨-lsyncd-åŒæ­¥-æœåŠ¡" class="headerlink" title="6. å¯ç”¨ lsyncd åŒæ­¥ æœåŠ¡"></a>6. å¯ç”¨ lsyncd åŒæ­¥ æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> lsyncd</span><br><span class="line">systemctl start lsyncd</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">systemctl status lsyncd -l</span><br></pre></td></tr></table></figure><p><img src="http://q068kveb3.bkt.clouddn.com/image/lsyncd1.png" alt=""></p><hr><h3 id="7-æ•ˆæœéªŒè¯"><a href="#7-æ•ˆæœéªŒè¯" class="headerlink" title="7. æ•ˆæœéªŒè¯"></a>7. æ•ˆæœéªŒè¯</h3><ul><li>å®æµ‹é¦–æ¬¡åŒæ­¥ï¼Œé€Ÿåº¦å¯è¾¾ 700mbpsï¼Œæœ¬æœºCPUå ç”¨ 20+%ã€‚</li><li>åŒæ­¥é…ç½®åï¼Œè¿›è¡Œæºæ–‡ä»¶çš„å¢åŠ ã€åˆ é™¤æµ‹è¯•ï¼Œè¿œç¨‹ç›®æ ‡ä¸»æœºèƒ½å‡†å®æ—¶è¿›è¡Œç›¸åº”çš„æ”¹å˜ã€‚</li><li>å¦‚æœAæ–‡ä»¶åŒæ­¥åˆ°è¿œç¨‹ç›®æ ‡ä¸»æœºåï¼Œè¿œç¨‹ç›®æ ‡ä¸»æœºè¿›è¡Œæ–‡ä»¶åˆ é™¤ã€‚åˆ™Aæ–‡ä»¶ä¸å‘ç”Ÿæ”¹å˜æƒ…å†µä¸‹ï¼Œè¿™ä¸ªAæ–‡ä»¶ä¸ä¼šå†æ¬¡åŒæ­¥åˆ°è¿œç¨‹ã€‚åªæœ‰å½“Aæ–‡ä»¶æ›´æ”¹åï¼Œæ‰ä¼šå†æ¬¡å°†Aæ–‡ä»¶åŒæ­¥åˆ°è¿œç¨‹ç›®æ ‡ä¸»æœºã€‚</li></ul><h3 id="8-æ—¥å¿—æŸ¥çœ‹"><a href="#8-æ—¥å¿—æŸ¥çœ‹" class="headerlink" title="8. æ—¥å¿—æŸ¥çœ‹"></a>8. æ—¥å¿—æŸ¥çœ‹</h3><p>ä»»ä½•æƒ…å†µä¸‹ï¼Œå‡å¯é€šè¿‡æŸ¥çœ‹ logfileã€statusFile è¿›è¡ŒåŒæ­¥ä¿¡æ¯ã€ä»»åŠ¡æ‰§è¡Œæƒ…å†µçš„æŸ¥çœ‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰äº›æ–‡ä»¶æ•°æ®è¶…çº§å¤§ï¼Œè¾¾åˆ°Tçš„æ•°é‡çº§ï¼Œå¦‚æœç”¨å¤‡ä»½ç³»ç»Ÿè¿›è¡Œå¤‡ä»½ï¼Œéœ€è¦ä¸Šå‘¨çš„æ—¶é—´ï¼Œè€Œä¸”å¤‡ä»½è¿‡ç¨‹ä¸­æ–‡ä»¶ä¹Ÿåœ¨ä¸æ–­å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´å¤‡ä»½æ–‡ä»¶ä¸å¯æ§ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»åˆ©ç”¨ lsyncd è¿›è¡Œä¸»ä»æ•°æ®çš„åŒæ—¶å¤‡ä»½ã€‚ lysncd å®é™…ä¸Šæ˜¯luaè¯­è¨€å°
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Centos" scheme="http://blog.sqj.me/tags/Centos/"/>
    
      <category term="é«˜å¹¶å‘" scheme="http://blog.sqj.me/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
      <category term="HA" scheme="http://blog.sqj.me/tags/HA/"/>
    
  </entry>
  
  <entry>
    <title>Nginxçš„è´Ÿè½½å‡è¡¡é…ç½®â€”â€”æ•…éšœè½¬ç§»</title>
    <link href="http://blog.sqj.me/2019/nginx-proxy-load-balance/"/>
    <id>http://blog.sqj.me/2019/nginx-proxy-load-balance/</id>
    <published>2019-11-13T10:02:13.000Z</published>
    <updated>2019-11-14T03:36:16.697Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Nginxåœ¨åå‘ä»£ç†ã€WebæœåŠ¡ã€è´Ÿè½½å‡è¡¡çš„é…ç½®èƒ½æœ‰å¾ˆé«˜çš„çµæ´»æ€§ï¼Œæœ¬æ–‡é’ˆå¯¹è´Ÿè½½å‡è¡¡è¿›è¡Œæè¿°ï¼Œå¹¶å¢åŠ è´Ÿè½½å‡è¡¡ã€‚</p></blockquote><h3 id="1-åç«¯æœåŠ¡å™¨æ± "><a href="#1-åç«¯æœåŠ¡å™¨æ± " class="headerlink" title="1. åç«¯æœåŠ¡å™¨æ± "></a>1. åç«¯æœåŠ¡å™¨æ± </h3><p>åœ¨serverèŠ‚å¤–ï¼Œé…ç½®æœåŠ¡å™¨æ± ï¼Œæ± é‡Œæ‰€æœ‰æœåŠ¡å™¨ï¼Œå‡æä¾›ç»Ÿä¸€çš„æœåŠ¡ï¼ˆè¿™ä¹Ÿæ˜¯è´Ÿè½½å‡è¡¡çš„åŸºç¡€ğŸï¼Œå¦‚æœåŒæ ·çš„åœ°å€ï¼Œè¿”å›å†…å®¹ä¸ä¸€æ ·ï¼Œ(ï¿£â–½ï¿£)â€ï¼‰ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">upstream media_server_pool#upstream åé¢è·Ÿ æœåŠ¡å™¨æ± åç§°</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">#ip_hash;# nginx ä»£ç†åˆ°åç«¯æœåŠ¡çš„è½®è¯¢æ–¹å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœåŠ¡å™¨ç¾¤ï¼Œå¯1~nå°</span></span><br><span class="line">server 172.18.0.194:8082weight=1 max_fails=2 fail_timeout=60s;</span><br><span class="line">server 172.18.0.192:8082weight=2 max_fails=2 fail_timeout=60s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.1 Nginxåˆ°åç«¯æœåŠ¡å™¨çš„è½®è¯¢æ–¹å¼</p><p>1.2 æœåŠ¡å™¨æ± ä¸­æ¯ä¸€å°serverçš„é…ç½®</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Nginxåœ¨åå‘ä»£ç†ã€WebæœåŠ¡ã€è´Ÿè½½å‡è¡¡çš„é…ç½®èƒ½æœ‰å¾ˆé«˜çš„çµæ´»æ€§ï¼Œæœ¬æ–‡é’ˆå¯¹è´Ÿè½½å‡è¡¡è¿›è¡Œæè¿°ï¼Œå¹¶å¢åŠ è´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;1-åç«¯æœåŠ¡å™¨æ± &quot;&gt;&lt;a href=&quot;#1-åç«¯æœåŠ¡å™¨æ± &quot; class=&quot;header
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Nginx" scheme="http://blog.sqj.me/tags/Nginx/"/>
    
      <category term="é«˜å¹¶å‘" scheme="http://blog.sqj.me/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Centoså¸¸ç”¨ç½‘ç»œè„šæœ¬</title>
    <link href="http://blog.sqj.me/2019/network-script/"/>
    <id>http://blog.sqj.me/2019/network-script/</id>
    <published>2019-11-13T09:52:25.000Z</published>
    <updated>2019-11-13T09:59:16.780Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Centoså¸¸ç”¨ç½‘ç»œè„šæœ¬</p></blockquote><h3 id="è·å–æœ¬æœºIP"><a href="#è·å–æœ¬æœºIP" class="headerlink" title="è·å–æœ¬æœºIP"></a>è·å–æœ¬æœºIP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ifconfig -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr EC:B1:D7:7F:15:BC</span><br><span class="line">          inet addr:172.16.0.199  Bcast:172.16.255.255  Mask:255.255.0.0</span><br><span class="line">          inet6 addr: fe80::eeb1:d7ff:fe7f:15bc/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:57066818 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:47386046 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000</span><br><span class="line">          RX bytes:55226093821 (51.4 GiB)  TX bytes:47035203014 (43.8 GiB)</span><br><span class="line">          Interrupt:16</span><br></pre></td></tr></table></figure><h3 id="è·å–å¤–ç½‘IP"><a href="#è·å–å¤–ç½‘IP" class="headerlink" title="è·å–å¤–ç½‘IP"></a>è·å–å¤–ç½‘IP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl ifconfig.me</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡º ä¸Šå¤–ç½‘çš„ip</span></span><br><span class="line">58.62.xx.xx</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Centoså¸¸ç”¨ç½‘ç»œè„šæœ¬&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;è·å–æœ¬æœºIP&quot;&gt;&lt;a href=&quot;#è·å–æœ¬æœºIP&quot; class=&quot;headerlink&quot; title=&quot;è·å–æœ¬æœºIP&quot;&gt;&lt;/a&gt;è·å–æœ¬æœºIP&lt;/h3&gt;&lt;figure cl
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Centos" scheme="http://blog.sqj.me/tags/Centos/"/>
    
  </entry>
  
  <entry>
    <title>é…ç½®Centosæ–‡ä»¶æ‰“å¼€æ•°</title>
    <link href="http://blog.sqj.me/2019/set-centos-open-files-count/"/>
    <id>http://blog.sqj.me/2019/set-centos-open-files-count/</id>
    <published>2019-11-12T06:26:23.000Z</published>
    <updated>2019-11-12T08:45:28.115Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Centos é»˜è®¤çš„æ–‡ä»¶æ‰“å¼€æ•°æ¯”è¾ƒä½ï¼ˆé»˜è®¤1024)ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¾ˆå®¹æ˜“å°±å¼•å‘æ–‡ä»¶æ‰“å¼€æ•°é™åˆ¶çš„é—®é¢˜ã€‚</p></blockquote><h3 id="æŸ¥çœ‹æ–‡ä»¶æ‰“å¼€æ•°-open-files"><a href="#æŸ¥çœ‹æ–‡ä»¶æ‰“å¼€æ•°-open-files" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶æ‰“å¼€æ•°(open files)"></a>æŸ¥çœ‹æ–‡ä»¶æ‰“å¼€æ•°(open files)</h3><h4 id="1ã€æŸ¥çœ‹å•ä¸ªè¿›ç¨‹å…è®¸æ‰“å¼€æ•°"><a href="#1ã€æŸ¥çœ‹å•ä¸ªè¿›ç¨‹å…è®¸æ‰“å¼€æ•°" class="headerlink" title="1ã€æŸ¥çœ‹å•ä¸ªè¿›ç¨‹å…è®¸æ‰“å¼€æ•°"></a>1ã€æŸ¥çœ‹å•ä¸ªè¿›ç¨‹å…è®¸æ‰“å¼€æ•°</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -a</span><br></pre></td></tr></table></figure><p><img src="http://q068kveb3.bkt.clouddn.com/image/openfiles1.png" alt=""></p><h4 id="2ã€æŸ¥çœ‹ç³»ç»Ÿæ€»ä½“èƒ½æ‰“å¼€æ•°ï¼ˆå¯¹æ‰€æœ‰è¿›ç¨‹ï¼‰"><a href="#2ã€æŸ¥çœ‹ç³»ç»Ÿæ€»ä½“èƒ½æ‰“å¼€æ•°ï¼ˆå¯¹æ‰€æœ‰è¿›ç¨‹ï¼‰" class="headerlink" title="2ã€æŸ¥çœ‹ç³»ç»Ÿæ€»ä½“èƒ½æ‰“å¼€æ•°ï¼ˆå¯¹æ‰€æœ‰è¿›ç¨‹ï¼‰"></a>2ã€æŸ¥çœ‹ç³»ç»Ÿæ€»ä½“èƒ½æ‰“å¼€æ•°ï¼ˆå¯¹æ‰€æœ‰è¿›ç¨‹ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/sys/fs/file-max</span><br><span class="line"></span><br><span class="line">789949<span class="comment">#è¿”å›å€¼</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹æ–‡ä»¶æ‰“å¼€æ•°"><a href="#ä¿®æ”¹æ–‡ä»¶æ‰“å¼€æ•°" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æ‰“å¼€æ•°"></a>ä¿®æ”¹æ–‡ä»¶æ‰“å¼€æ•°</h3><h4 id="1ã€ä¿®æ”¹-etc-security-limits-conf-ï¼Œå…è®¸ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€æ•°é‡"><a href="#1ã€ä¿®æ”¹-etc-security-limits-conf-ï¼Œå…è®¸ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€æ•°é‡" class="headerlink" title="1ã€ä¿®æ”¹ /etc/security/limits.conf ï¼Œå…è®¸ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€æ•°é‡"></a>1ã€ä¿®æ”¹ /etc/security/limits.conf ï¼Œå…è®¸ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€æ•°é‡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨æœ€åæ·»åŠ </span></span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br></pre></td></tr></table></figure><h4 id="2ã€ä¿®æ”¹æ‰€æœ‰è¿›ç¨‹å…è®¸æ€»å…±æ–‡ä»¶æ‰“å¼€æ•°é‡"><a href="#2ã€ä¿®æ”¹æ‰€æœ‰è¿›ç¨‹å…è®¸æ€»å…±æ–‡ä»¶æ‰“å¼€æ•°é‡" class="headerlink" title="2ã€ä¿®æ”¹æ‰€æœ‰è¿›ç¨‹å…è®¸æ€»å…±æ–‡ä»¶æ‰“å¼€æ•°é‡"></a>2ã€ä¿®æ”¹æ‰€æœ‰è¿›ç¨‹å…è®¸æ€»å…±æ–‡ä»¶æ‰“å¼€æ•°é‡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æ–‡ä»¶ä¸­å¢åŠ </span></span><br><span class="line">fs.file-max = 6553560</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿å…¶ç”Ÿæ•ˆ</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h4 id="3ã€æŸ¥çœ‹ä¿®æ”¹ç»“æœ"><a href="#3ã€æŸ¥çœ‹ä¿®æ”¹ç»“æœ" class="headerlink" title="3ã€æŸ¥çœ‹ä¿®æ”¹ç»“æœ"></a>3ã€æŸ¥çœ‹ä¿®æ”¹ç»“æœ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -a</span><br></pre></td></tr></table></figure><p><img src="http://q068kveb3.bkt.clouddn.com/image/openfiles2.png" alt=""></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/sys/fs/file-max</span><br><span class="line"></span><br><span class="line">789949<span class="comment">#è¿”å›å€¼</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Centos é»˜è®¤çš„æ–‡ä»¶æ‰“å¼€æ•°æ¯”è¾ƒä½ï¼ˆé»˜è®¤1024)ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¾ˆå®¹æ˜“å°±å¼•å‘æ–‡ä»¶æ‰“å¼€æ•°é™åˆ¶çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;æŸ¥çœ‹æ–‡ä»¶æ‰“å¼€æ•°-open-files&quot;&gt;&lt;a href=&quot;#æŸ¥çœ‹æ–‡ä»¶æ‰“å¼€æ•°-open-file
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Centos" scheme="http://blog.sqj.me/tags/Centos/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•é…ç½®nginxçš„æ—¥å¿—æ ¼å¼</title>
    <link href="http://blog.sqj.me/2019/how-to-config-log-format-in-nginx/"/>
    <id>http://blog.sqj.me/2019/how-to-config-log-format-in-nginx/</id>
    <published>2019-11-11T02:57:35.000Z</published>
    <updated>2019-11-12T04:23:12.683Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Nginxçš„Logè¯¦ç»†é…ç½®ï¼Œå¯ä»¥å‚è€ƒ <a href="http://nginx.org/en/docs/http/ngx_http_log_module.html" target="_blank" rel="noopener"> http://nginx.org/en/docs/http/ngx_http_log_module.html </a> é‡Œé¢æœ‰è¯¦ç»†è¯´æ˜</p></blockquote><h3 id="é…ç½®æ—¥å¿—æ ¼å¼"><a href="#é…ç½®æ—¥å¿—æ ¼å¼" class="headerlink" title="é…ç½®æ—¥å¿—æ ¼å¼"></a>é…ç½®æ—¥å¿—æ ¼å¼</h3><p>æ ¼å¼ä¸ºï¼šlog_format [æ ¼å¼åç§°] [æ ¼å¼æè¿°] ã€‚å…¶ä¸­ï¼Œæ ¼å¼æè¿°æ”¯æŒå˜é‡ï¼Œå¦‚ $http_hostç­‰ç­‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">log_format format_name <span class="string">'$remote_addr - $remote_user [$time_local] '</span></span><br><span class="line">                       <span class="string">'"$request" $status $bytes_sent '</span></span><br><span class="line">                       <span class="string">'"$http_referer" "$http_user_agent" "$gzip_ratio"'</span>;</span><br></pre></td></tr></table></figure><p>ä»¥åŠ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">log_format format_name  <span class="string">'$remote_addr - $remote_user [$time_local]'</span> <span class="string">'- "$http_host" - "$request" '</span></span><br><span class="line"><span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line"><span class="string">'"$http_user_agent" $http_x_forwarded_for'</span>;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ—¥å¿—æ ¼å¼"><a href="#ä½¿ç”¨æ—¥å¿—æ ¼å¼" class="headerlink" title="ä½¿ç”¨æ—¥å¿—æ ¼å¼"></a>ä½¿ç”¨æ—¥å¿—æ ¼å¼</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access_log /path-to-log/nginx-access.log format_name buffer=32k;</span><br></pre></td></tr></table></figure><p>bufferå¯ä»¥å¿½ç•¥ã€‚å¦‚æœè®¾ç½®äº†bufferï¼Œåˆ™å†™å…¥logçš„è§„åˆ™å¦‚ä¸‹ï¼ˆåº”ç”¨nginxå®˜æ–¹è¯´æ˜ï¼‰</p><ul><li>if the next log line does not fit into the buffer;</li><li>if the buffered data is older than specified by the <code>flush</code> parameter (1.3.10, 1.2.7);</li><li>when a worker process is <a href="http://nginx.org/en/docs/control.html" target="_blank" rel="noopener">re-opening</a> log files or is shutting down.</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Nginxçš„Logè¯¦ç»†é…ç½®ï¼Œå¯ä»¥å‚è€ƒ &lt;a href=&quot;http://nginx.org/en/docs/http/ngx_http_log_module.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt; http://n
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Nginx" scheme="http://blog.sqj.me/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>php-fpmå‚æ•°è°ƒä¼˜</title>
    <link href="http://blog.sqj.me/2019/php-fpm-optimize1/"/>
    <id>http://blog.sqj.me/2019/php-fpm-optimize1/</id>
    <published>2019-11-08T07:23:18.000Z</published>
    <updated>2019-11-12T08:21:57.352Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>php-fpm å‚æ•°è°ƒæ•´ä¼˜åŒ–è®°å½•</p></blockquote><h3 id="åŸºæœ¬å‚æ•°é…ç½®"><a href="#åŸºæœ¬å‚æ•°é…ç½®" class="headerlink" title="åŸºæœ¬å‚æ•°é…ç½®"></a>åŸºæœ¬å‚æ•°é…ç½®</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">; pool name ('www' here)</span></span><br><span class="line"><span class="section">[www]</span></span><br><span class="line"><span class="attr">user</span> = www</span><br><span class="line"><span class="attr">group</span> = www</span><br><span class="line"></span><br><span class="line"><span class="comment">#é™åˆ¶ç»‘å®šè®¿é—®æ¥æº</span></span><br><span class="line"><span class="attr">listen</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span></span><br><span class="line"><span class="attr">listen.allowed_clients</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pm è®¾ç½®ä¸º dynamic æˆ–è€…static</span></span><br><span class="line"><span class="attr">pm</span> = dynamic</span><br><span class="line"></span><br><span class="line"><span class="comment"># pmä¸ºstaticæ—¶ï¼Œå¯ä»¥å»ºè®¾php-fpmè¿›ç¨‹è°ƒåº¦çš„èµ„æºæ¶ˆè€—ã€‚</span></span><br><span class="line"><span class="comment"># 32Gå†…å­˜ï¼Œstatic æ¨¡å¼ä¸‹ï¼Œmax_childrenå¯ä»¥é…ç½®ä¸º 800</span></span><br><span class="line"><span class="comment"># ä»¥ä¸‹é…ç½®ä¸º 4æ ¸CPUã€16Gå†…å­˜çš„é…ç½®</span></span><br><span class="line"><span class="attr">pm.max_children</span> = <span class="number">128</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pm.start_servers</span> = <span class="number">32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pm.min_spare_servers</span> = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pm.max_spare_servers</span> = <span class="number">40</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pm.max_requests</span> = <span class="number">2048</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;slowlog = log/$pool.log.slow</span></span><br></pre></td></tr></table></figure><p>å…³æ³¨ç‚¹1ï¼šmax_childrençš„æ•°å€¼ï¼Œæœ€å¤§php-fpmå¯å…è®¸çš„è¿›ç¨‹æ•°é‡ï¼Œç”±æœ¬æœºèµ„æºé™åˆ¶</p><p>å…³æ³¨ç‚¹2ï¼šmax_requestsï¼Œå½“å‡ºç°å†…å­˜æ³„éœ²çš„æ—¶å€™ï¼Œè¯¥å€¼å¯ä»¥è®¾ç½®å°ä¸€ç‚¹ï¼Œä¾¿äºè¿›ç¨‹åŠæ—¶å›æ”¶ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;php-fpm å‚æ•°è°ƒæ•´ä¼˜åŒ–è®°å½•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;åŸºæœ¬å‚æ•°é…ç½®&quot;&gt;&lt;a href=&quot;#åŸºæœ¬å‚æ•°é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;åŸºæœ¬å‚æ•°é…ç½®&quot;&gt;&lt;/a&gt;åŸºæœ¬å‚æ•°é…ç½®&lt;/h3&gt;&lt;figur
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Centos" scheme="http://blog.sqj.me/tags/Centos/"/>
    
      <category term="php" scheme="http://blog.sqj.me/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>Centosä¸‹æŸ¥çœ‹å†…å­˜å ç”¨æƒ…å†µçš„æ–¹æ³•</title>
    <link href="http://blog.sqj.me/2019/methods-to-get-memory-usage/"/>
    <id>http://blog.sqj.me/2019/methods-to-get-memory-usage/</id>
    <published>2019-11-07T07:21:28.000Z</published>
    <updated>2019-11-12T08:46:56.103Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è·å–è¿›ç¨‹cpuå ç”¨ç‡çš„æ–¹æ³•ï¼Œä»¥ä¸‹ä»£ç ä»¥php-fpmä¸ºä¾‹</p></blockquote><h3 id="top-è·å–å†…å­˜å ç”¨ç‡"><a href="#top-è·å–å†…å­˜å ç”¨ç‡" class="headerlink" title="top è·å–å†…å­˜å ç”¨ç‡"></a>top è·å–å†…å­˜å ç”¨ç‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">top</span><br><span class="line"><span class="comment"># è¿”å› å†…å­˜å ç”¨æ’è¡Œ</span></span><br><span class="line">M</span><br><span class="line"></span><br><span class="line">top - 16:25:00 up  2:02,  1 user,  load average: 0.14, 0.13, 0.07</span><br><span class="line">Tasks: 190 total,   1 running, 189 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  0.2 us,  0.3 sy,  0.0 ni, 99.6 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem : 16257496 total, 15488716 free,   601532 used,   167248 buff/cache</span><br><span class="line">KiB Swap:  2097148 total,  2097148 free,        0 used. 15401912 avail Mem</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</span><br><span class="line"> 1255 root      20   0  358748  29496   7048 S   0.0  0.2   0:01.13 firewalld</span><br><span class="line"> 1582 root      20   0  574196  17412   6120 S   0.0  0.1   0:01.26 tuned</span><br><span class="line"> 1708 www       20   0  365248  16252   3620 S   0.0  0.1   0:14.68 php-fpm</span><br><span class="line"> 1717 www       20   0  365256  16252   3616 S   0.0  0.1   0:15.21 php-fpm</span><br><span class="line"> 1687 www       20   0  365252  16248   3616 S   0.0  0.1   0:15.06 php-fpm</span><br><span class="line"> 1700 www       20   0  365252  16220   3616 S   0.0  0.1   0:12.09 php-fpm</span><br></pre></td></tr></table></figure><h3 id="è·å–æŸè¿›ç¨‹çš„å†…å­˜æš‚ç”¨ç‡"><a href="#è·å–æŸè¿›ç¨‹çš„å†…å­˜æš‚ç”¨ç‡" class="headerlink" title="è·å–æŸè¿›ç¨‹çš„å†…å­˜æš‚ç”¨ç‡"></a>è·å–æŸè¿›ç¨‹çš„å†…å­˜æš‚ç”¨ç‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ps -e -o <span class="string">'pid,comm,args,pcpu,rsz,vsz,stime,user,uid'</span>|grep www|sort -nrk5</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿”å›</span></span><br><span class="line">47429 grep            grep --color=auto www        0.0   960 112716 16:26 root         0</span><br><span class="line"> 1720 php-fpm         php-fpm: pool www            0.1 13420 362180 14:22 www       1000</span><br><span class="line"> 1719 php-fpm         php-fpm: pool www            0.1 16132 364992 14:22 www       1000</span><br><span class="line">...</span><br><span class="line"> 1692 php-fpm         php-fpm: pool www            0.1 16088 364996 14:22 www       1000</span><br><span class="line"> 1691 php-fpm         php-fpm: pool www            0.2 15980 364996 14:22 www       1000</span><br><span class="line"> 1689 php-fpm         php-fpm: pool www            0.2 12932 361668 14:22 www       1000</span><br><span class="line"> 1688 php-fpm         php-fpm: pool www            0.1 12908 361668 14:22 www       1000</span><br><span class="line"> 1687 php-fpm         php-fpm: pool www            0.2 16248 365252 14:22 www       1000</span><br><span class="line"> 1620 nginx           nginx: worker process        0.0 10928  55404 14:22 www       1000</span><br><span class="line"> 1619 nginx           nginx: worker process        0.0 10932  55404 14:22 www       1000</span><br><span class="line"> 1618 nginx           nginx: worker process        0.0 10932  55404 14:22 www       1000</span><br><span class="line"> 1617 nginx           nginx: worker process        0.0 11120  55404 14:22 www       1000</span><br></pre></td></tr></table></figure><h3 id="è¿›ç¨‹å¹³å‡å†…å­˜å ç”¨ç‡"><a href="#è¿›ç¨‹å¹³å‡å†…å­˜å ç”¨ç‡" class="headerlink" title="è¿›ç¨‹å¹³å‡å†…å­˜å ç”¨ç‡"></a>è¿›ç¨‹å¹³å‡å†…å­˜å ç”¨ç‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ps --no-headers -o <span class="string">"rss,cmd"</span> -C php-fpm | awk <span class="string">'&#123; sum+=$1 &#125; END &#123; printf ("%d%s\n", sum/NR/1024,"M") &#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿”å›</span></span><br><span class="line">15M</span><br></pre></td></tr></table></figure><h3 id="æ€»ä½“å†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#æ€»ä½“å†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æ€»ä½“å†…å­˜ä½¿ç”¨æƒ…å†µ"></a>æ€»ä½“å†…å­˜ä½¿ç”¨æƒ…å†µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿”å›</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            15G        599M         14G        9.2M        164M         14G</span><br><span class="line">Swap:          2.0G          0B        2.0G</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;è·å–è¿›ç¨‹cpuå ç”¨ç‡çš„æ–¹æ³•ï¼Œä»¥ä¸‹ä»£ç ä»¥php-fpmä¸ºä¾‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;top-è·å–å†…å­˜å ç”¨ç‡&quot;&gt;&lt;a href=&quot;#top-è·å–å†…å­˜å ç”¨ç‡&quot; class=&quot;headerlink&quot; title=&quot;top è·å–å†…
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Centos" scheme="http://blog.sqj.me/tags/Centos/"/>
    
  </entry>
  
  <entry>
    <title>linux centos é‡Šæ”¾cacheçš„æ–¹æ³•</title>
    <link href="http://blog.sqj.me/2019/linux-centos-free-cache/"/>
    <id>http://blog.sqj.me/2019/linux-centos-free-cache/</id>
    <published>2019-11-06T03:34:37.000Z</published>
    <updated>2019-11-06T04:52:10.537Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒCentoså†…å­˜freeå¾ˆå°ï¼Œcacheå¾ˆå¤§ï¼Œå¯è¿›è¡Œè°ƒæ•´"><a href="#ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒCentoså†…å­˜freeå¾ˆå°ï¼Œcacheå¾ˆå¤§ï¼Œå¯è¿›è¡Œè°ƒæ•´" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒCentoså†…å­˜freeå¾ˆå°ï¼Œcacheå¾ˆå¤§ï¼Œå¯è¿›è¡Œè°ƒæ•´"></a>ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒCentoså†…å­˜freeå¾ˆå°ï¼Œcacheå¾ˆå¤§ï¼Œå¯è¿›è¡Œè°ƒæ•´</h3><p>1ã€æŸ¥çœ‹å†…å­˜æƒ…å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -m</span><br></pre></td></tr></table></figure><p><img src="http://q068kveb3.bkt.clouddn.com/image/free-m.png" alt=""></p><p>2ã€æŸ¥çœ‹ç³»ç»Ÿå†…å­˜ç®¡ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/sys/vm/drop_caches</span><br><span class="line">0</span><br></pre></td></tr></table></figure><p>3ã€é…ç½®è‡ªåŠ¨æ¸…é™¤å†…å­˜cache</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œå¯ä»¥é€‰æ‹©1ã€2ã€3ç§æ¨¡å¼</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/vm/drop_caches <span class="comment">#è¡¨ç¤ºæ¸…é™¤pagecacheã€‚</span></span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/vm/drop_caches <span class="comment">#è¡¨ç¤ºæ¸…é™¤å›æ”¶slabåˆ†é…å™¨ä¸­çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬ç›®å½•é¡¹ç¼“å­˜å’Œinodeç¼“å­˜ï¼‰ã€‚slabåˆ†é…å™¨æ˜¯å†…æ ¸ä¸­ç®¡ç†å†…å­˜çš„ä¸€ç§æœºåˆ¶ï¼Œå…¶ä¸­å¾ˆå¤šç¼“å­˜æ•°æ®å®ç°éƒ½æ˜¯ç”¨çš„pagecacheã€‚</span></span><br><span class="line"><span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches <span class="comment">#è¡¨ç¤ºæ¸…é™¤pagecacheå’Œslabåˆ†é…å™¨ä¸­çš„ç¼“å­˜å¯¹è±¡ã€‚</span></span><br></pre></td></tr></table></figure><p>4ã€æŸ¥çœ‹é…ç½®åçš„æƒ…å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -h</span><br></pre></td></tr></table></figure><p>5ã€æ³¨æ„ï¼Œé…ç½®å®Œå†…å­˜å¤„ç†æ–¹å¼åï¼Œå¯èƒ½æ— æ³•æ¢å¤æˆ0çš„çŠ¶æ€ï¼Œæ—¢ç”±ç³»ç»Ÿè‡ªåŠ¨è¿›è¡Œå†…å­˜ç®¡ç†å’Œæ¸…é™¤ã€‚</p><p>æ­¤æ—¶ï¼Œå¯ä»¥é‡å¯æœåŠ¡å™¨ï¼Œé‡å¯åç³»ç»Ÿè‡ªåŠ¨é…ç½®ä¸ºçŠ¶æ€0ã€‚</p><p>è¿›ä¸€æ­¥äº†è§£Cacheï¼Œå¯ä»¥æŸ¥é˜…  <a href="https://www.v2ex.com/t/278921" target="_blank" rel="noopener">https://www.v2ex.com/t/278921</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒCentoså†…å­˜freeå¾ˆå°ï¼Œcacheå¾ˆå¤§ï¼Œå¯è¿›è¡Œè°ƒæ•´&quot;&gt;&lt;a href=&quot;#ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒCentoså†…å­˜freeå¾ˆå°ï¼Œcacheå¾ˆå¤§ï¼Œå¯è¿›è¡Œè°ƒæ•´&quot; class=&quot;headerlink&quot; title=&quot;ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒCentoså†…å­˜freeå¾ˆå°ï¼Œcac
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Centos" scheme="http://blog.sqj.me/tags/Centos/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•åœ¨Nginxä¸­å±è”½ç‰¹å®šçš„åœ°å€æˆ–æ–‡ä»¶å¤¹</title>
    <link href="http://blog.sqj.me/2019/how-to-ban-particular-floder-in-nginx/"/>
    <id>http://blog.sqj.me/2019/how-to-ban-particular-floder-in-nginx/</id>
    <published>2019-11-06T00:30:00.000Z</published>
    <updated>2019-11-12T04:31:20.132Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Nginxæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½Web/ProxyæœåŠ¡å™¨ã€‚æœ¬æ–‡å°†é…ç½®Nginxï¼Œå±è”½å¯¹äºç‰¹å®šUrlæˆ–æ–‡ä»¶å¤¹çš„è®¿é—®ã€‚</p></blockquote><h3 id="å±è”½ç‰¹å®šæ–‡ä»¶å¤¹çš„è®¿é—®"><a href="#å±è”½ç‰¹å®šæ–‡ä»¶å¤¹çš„è®¿é—®" class="headerlink" title="å±è”½ç‰¹å®šæ–‡ä»¶å¤¹çš„è®¿é—®"></a>å±è”½ç‰¹å®šæ–‡ä»¶å¤¹çš„è®¿é—®</h3><p>å®é™…ç½‘é¡µä¸­ï¼Œæœ‰äº›åœ°å€æ˜¯ä¸å…è®¸å¤–éƒ¨è¿›è¡Œè®¿é—®çš„ï¼Œå¯é€šè¿‡é…ç½®locationèŠ‚ï¼Œè¿›è¡Œç‰¹å®šåœ°å€å±è”½ã€‚</p><h4 id="1ã€æ–°å¢ä¸€ä¸ªé™åˆ¶è®¿é—®æ–‡ä»¶é…ç½®å¯¹åº”çš„å±è”½ä¿¡æ¯ï¼Œæ–¹ä¾¿åç»­å¼•å…¥æ¯ä¸€ä¸ªç«™ç‚¹çš„é…ç½®æ–‡ä»¶ä¸­"><a href="#1ã€æ–°å¢ä¸€ä¸ªé™åˆ¶è®¿é—®æ–‡ä»¶é…ç½®å¯¹åº”çš„å±è”½ä¿¡æ¯ï¼Œæ–¹ä¾¿åç»­å¼•å…¥æ¯ä¸€ä¸ªç«™ç‚¹çš„é…ç½®æ–‡ä»¶ä¸­" class="headerlink" title="1ã€æ–°å¢ä¸€ä¸ªé™åˆ¶è®¿é—®æ–‡ä»¶é…ç½®å¯¹åº”çš„å±è”½ä¿¡æ¯ï¼Œæ–¹ä¾¿åç»­å¼•å…¥æ¯ä¸€ä¸ªç«™ç‚¹çš„é…ç½®æ–‡ä»¶ä¸­"></a>1ã€æ–°å¢ä¸€ä¸ªé™åˆ¶è®¿é—®æ–‡ä»¶é…ç½®å¯¹åº”çš„å±è”½ä¿¡æ¯ï¼Œæ–¹ä¾¿åç»­å¼•å…¥æ¯ä¸€ä¸ªç«™ç‚¹çš„é…ç½®æ–‡ä»¶ä¸­</h4><h4 id="2ã€é…ç½®å±è”½ä¿¡æ¯"><a href="#2ã€é…ç½®å±è”½ä¿¡æ¯" class="headerlink" title="2ã€é…ç½®å±è”½ä¿¡æ¯"></a>2ã€é…ç½®å±è”½ä¿¡æ¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å±è”½ç‰¹å®šç›®å½•ä¸‹çš„æ–‡ä»¶</span></span><br><span class="line">location ~* /(check|login|logincheck)\.(php|aspx|asp|html|jsp) </span><br><span class="line">&#123;</span><br><span class="line">deny all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å±è”½ç‰¹å®šç›®å½•</span></span><br><span class="line">location ~* /(config|cnkadmin|eWebEditor|admin|_notes)/ </span><br><span class="line">&#123;</span><br><span class="line">deny all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3ã€å°†è¯¥æ–‡ä»¶åœ¨å¯¹åº”çš„ç«™ç‚¹æ–‡ä»¶ä¸­å¼•å…¥"><a href="#3ã€å°†è¯¥æ–‡ä»¶åœ¨å¯¹åº”çš„ç«™ç‚¹æ–‡ä»¶ä¸­å¼•å…¥" class="headerlink" title="3ã€å°†è¯¥æ–‡ä»¶åœ¨å¯¹åº”çš„ç«™ç‚¹æ–‡ä»¶ä¸­å¼•å…¥"></a>3ã€å°†è¯¥æ–‡ä»¶åœ¨å¯¹åº”çš„ç«™ç‚¹æ–‡ä»¶ä¸­å¼•å…¥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include _common_config.conf;</span><br></pre></td></tr></table></figure><p>4ã€Postmanæµ‹è¯•</p><p><img src="http://q068kveb3.bkt.clouddn.com/image/postman-test-after-config2.png" alt=""></p><hr><p>åœ¨Nginxä¸­ï¼Œå±è”½ç‰¹å®šç‰¹å®šIP/UAçš„è®¿é—®ï¼Œè¯·çœ‹ <a href="/2019/how-to-ban-ip-or-ua-in-nginx">é…ç½®nginxå±è”½ç‰¹å®šIP/UAçš„è®¿é—®</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Nginxæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½Web/ProxyæœåŠ¡å™¨ã€‚æœ¬æ–‡å°†é…ç½®Nginxï¼Œå±è”½å¯¹äºç‰¹å®šUrlæˆ–æ–‡ä»¶å¤¹çš„è®¿é—®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;å±è”½ç‰¹å®šæ–‡ä»¶å¤¹çš„è®¿é—®&quot;&gt;&lt;a href=&quot;#å±è”½ç‰¹å®šæ–‡ä»¶å¤¹çš„è®¿é—®&quot; class=&quot;head
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Nginx" scheme="http://blog.sqj.me/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>Zabbixå•ç‚¹ç™»å½•å¼€å‘sso</title>
    <link href="http://blog.sqj.me/2019/zabbix-sso/"/>
    <id>http://blog.sqj.me/2019/zabbix-sso/</id>
    <published>2019-11-05T04:31:26.000Z</published>
    <updated>2019-11-05T09:15:59.358Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Zabbixæ˜¯ä¸€ä¸ªè€ç‰Œçš„ç³»ç»Ÿç›‘æ§è½¯ä»¶ã€‚æ˜¯ä¸€ä¸ªé«˜åº¦é›†æˆçš„ç½‘ç»œç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥æä¾›ä¼ä¸šçº§çš„å¼€æºåˆ†å¸ƒå¼ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚</p><p>Zabbixæ˜¯ä¸€ä¸ªåŸºäºWebç•Œé¢çš„ï¼Œæä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›‘æ§ä»¥åŠç½‘ç»œç›‘è§†åŠŸèƒ½çš„ä¼ä¸šçº§çš„å¼€æºè§£å†³æ–¹æ¡ˆã€‚èƒ½çµæ´»ç›‘è§†å„ç§ç½‘ç»œå‚æ•°ï¼Œä¿è¯æœåŠ¡å™¨ç³»ç»Ÿçš„å®‰å…¨è¿è¥ï¼Œå¹¶æä¾›çµæ´»çš„é€šçŸ¥æœºåˆ¶ä»¥è®©ç³»ç»Ÿç®¡ç†å‘˜å¿«é€Ÿå®šä½/è§£å†³å­˜åœ¨çš„å„ç§é—®é¢˜ã€‚</p><p>Zabbixå¯ä»¥åˆ†4éƒ¨åˆ†ï¼šZabbix serverã€Zabbix agentã€Zabbix proxyï¼ˆå¯é€‰ï¼‰ã€Zabbix webã€‚</p><p>Zabbix ä¸»è¦ç›‘æ§æ‰‹æ®µåŒ…æ‹¬ï¼šZabbix agentã€snmpã€ipmiã€fpingã€httpç›‘æµ‹ç­‰æ–¹å¼ï¼ŒåŸºæœ¬æ¶µç›–äº†ä¸»è¦çš„ç›‘æ§æ‰‹æ®µã€‚</p><hr><p><strong>æœ¬æ–‡ä¸»è¦æè¿°å¦‚ä½•å®šåˆ¶Zabbixçš„å•ç‚¹ç™»å½•ï¼Œç»è¿‡4.2/4.4ç‰ˆæµ‹è¯•ã€‚</strong></p></blockquote><h3 id="Zabbixç™»å½•æ–¹å¼"><a href="#Zabbixç™»å½•æ–¹å¼" class="headerlink" title="Zabbixç™»å½•æ–¹å¼"></a>Zabbixç™»å½•æ–¹å¼</h3><p>Zabbixä¸»è¦æœ‰3ä¸­ç™»å½•æ–¹å¼</p><ol><li>æ™®é€šè´¦å·/å¯†ç è®¤è¯ï¼Œæœ€å¸¸ç”¨çš„æ–¹å¼ã€‚</li><li>httpè®¤è¯ï¼Œé€šè¿‡apache/nginxæä¾›ç”¨æˆ·è¿›è¡Œè®¤è¯ï¼Œé€‚ç”¨äºç®€å•çš„åœºæ™¯ã€‚</li><li>LDAPç™»å½•ï¼Œé€‚ç”¨äºç»„ç»‡å†…éƒ¨è¿è¡Œæœ‰ADçš„ç¯å¢ƒã€‚</li></ol><p>Zabbixæ²¡æœ‰ä¸€ç§ç›´æ¥å¯¹æ¥SSOç³»ç»Ÿçš„æ–¹å¼ã€‚è€ŒLDAPæ–¹å¼ä¹Ÿä¸ä¾¿äºè¿›è¡Œè´¦å·çš„æ§åˆ¶ï¼ˆè¿›å…¥Zabbixçš„ç”¨æˆ·ä¸€èˆ¬éƒ½æ˜¯å°‘æ•°å‡ ä¸ªäººï¼‰ï¼Œæ•…éœ€è¦å¯¹Zabbixè¿›è¡Œå®šåˆ¶åŒ–æ”¹é€ ï¼Œå®ç°ä¸ç°æœ‰ç³»ç»Ÿçš„æ•´åˆé›†æˆã€‚</p><h3 id="Zabbixå•ç‚¹ç™»å½•SSOå®šåˆ¶æ€è·¯"><a href="#Zabbixå•ç‚¹ç™»å½•SSOå®šåˆ¶æ€è·¯" class="headerlink" title="Zabbixå•ç‚¹ç™»å½•SSOå®šåˆ¶æ€è·¯"></a>Zabbixå•ç‚¹ç™»å½•SSOå®šåˆ¶æ€è·¯</h3><p>åœ¨4.xç‰ˆæœ¬ä¸‹ï¼Œé¦–é¡µä»£ç index.phpç™»å½•çš„å…¥å£ã€‚å¯ä»¥é‡å†™ä¸€ä¸ªssoçš„ç™»å½•å…¥å£ï¼Œä½œä¸ºssoç³»ç»Ÿä¼ é€’tokenè¿‡æ¥çš„ç€é™†é¡µé¢ï¼Œè¿›è¡Œç›¸å…³çš„ç™»å½•é€»è¾‘å¤„ç†ã€‚</p><p><strong>ç”¨æˆ·é‰´æƒï¼š</strong>Zabbixé€šè¿‡CWebUserï¼ˆ/include/classes/user/CWebUser.phpï¼‰å°è£…äº†å¯¹ç”¨æˆ·é‰´æƒçš„æ“ä½œã€‚</p><p><strong>æ¥å£å°è£…ï¼š</strong>CWebUserè°ƒç”¨ç”¨æˆ·api CUserï¼ˆ/include/classes/api/services/CUser.php)ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œé‰´æƒã€‚</p><p><strong>SSOå®šåˆ¶æ€è·¯ï¼š</strong></p><ol><li>ä»¿ç…§index.phpï¼Œç¼–åˆ¶ fromportalsso.php  (å•ç‚¹ç™»å½•ç€é™†é¡µé¢)ï¼Œè°ƒç”¨CWebUserä¸­çš„ç™»å½•å‡½æ•°ã€‚</li><li>æ”¹å†™CWebUserï¼Œå¢åŠ å•ç‚¹ç™»å½•çš„å‡½æ•°ã€‚</li><li>æ”¹å†™CUserï¼Œå®ç°å•ç‚¹ç™»å½•ã€‚</li></ol><h3 id="å…·ä½“ä»£ç ä¿®æ”¹"><a href="#å…·ä½“ä»£ç ä¿®æ”¹" class="headerlink" title="å…·ä½“ä»£ç ä¿®æ”¹"></a>å…·ä½“ä»£ç ä¿®æ”¹</h3><p>1ã€ç™»å½•ç€é™†é¡µé¢fromportalsso.phpå…³é”®ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CWebUser::logout();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*--------------- é€šè¿‡ token è·å– uname -------------------------*/</span></span><br><span class="line"><span class="comment">//SSO ä¼ é€’tokenï¼Œé€šè¿‡tokenè·å–ç”¨æˆ·å $uname è¿‡ç¨‹çœç•¥</span></span><br><span class="line"><span class="comment">//è¿™ä¸ªç¯èŠ‚ï¼Œæ˜¯æ§åˆ¶è´¦å·å®‰å…¨çš„å…³é”®ç¯èŠ‚ã€‚</span></span><br><span class="line"><span class="comment">/*--------------- é€šè¿‡ token è·å– uname ç»“æŸ-------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// login via portal sso</span></span><br><span class="line"><span class="keyword">if</span> ( CWebUser::login_from_portalsso($uname)) &#123;</span><br><span class="line">$redirect = $rdi!=<span class="string">""</span> ? $rdi : ZBX_DEFAULT_URL;</span><br><span class="line">redirect($redirect);</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€ä¿®æ”¹CWebUser.phpï¼Œå¢åŠ ä¸€ä¸ªå‡½æ•° login_from_portalsso($login)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">login_from_portalsso</span><span class="params">($login)</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">self</span>::setDefault();</span><br><span class="line"><span class="keyword">self</span>::$data = API::User()-&gt;login([</span><br><span class="line"><span class="string">'user'</span> =&gt; $login,</span><br><span class="line"><span class="string">'password'</span> =&gt; <span class="string">'NotAPassWord'</span>,<span class="comment">//è¿™ä¸ªéšä¾¿å†™</span></span><br><span class="line"><span class="string">'userData'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line"><span class="string">'fromsso'</span> =&gt; <span class="number">1</span><span class="comment">//å¢åŠ å•ç‚¹ç™»å½•çš„æ ‡è¯†</span></span><br><span class="line">],<span class="keyword">true</span>);</span><br><span class="line">        </span><br><span class="line"><span class="comment">//å…¶ä½™å†…å®¹å’Œ login($login, $password) å‡½æ•°ä¸€æ ·ã€‚</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥è°ƒç”¨é»˜è®¤çš„CUser::loginå‡½æ•°ã€‚ å®è·µä¸­ï¼Œå¦‚æœè°ƒç”¨äº†å…¶å®ƒçš„å‡½æ•°ï¼Œå¯èƒ½ä¼šå‘ç”Ÿä¸æˆåŠŸçš„ç°è±¡ï¼Œåº”è¯¥æ˜¯æ¥å£æ£€éªŒçš„æ—¶å€™ï¼Œæ ¹æ®è§„åˆ™ï¼Œè¿›è¡Œäº†è¿‡æ»¤å¯¼è‡´è°ƒç”¨å¤±è´¥ã€‚æ‰€ä»¥æœ€ç®€å•ç›´æ¥çš„æ–¹æ³•ï¼Œå°±æ˜¯ä¿®æ”¹é»˜è®¤çš„loginå‡½æ•°ã€‚</p><p>3ã€ä¿®æ”¹ CUser.php çš„loginå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $user</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> string|array</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">(array $user)</span> </span>&#123;</span><br><span class="line">$api_input_rules = [<span class="string">'type'</span> =&gt; API_OBJECT, <span class="string">'fields'</span> =&gt; [</span><br><span class="line"><span class="string">'user'</span> =&gt; ...,</span><br><span class="line"><span class="string">'password'</span> =&gt; ...,</span><br><span class="line"><span class="string">'userData'</span> =&gt;[<span class="string">'type'</span> =&gt; API_FLAG],</span><br><span class="line"><span class="string">'fromsso'</span> =&gt;[<span class="string">'type'</span> =&gt; API_FLAG]<span class="comment">//æ£€éªŒæ˜¯å¦æ¥è‡ªssoç³»ç»Ÿ</span></span><br><span class="line">]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœæ¥è‡ªssoç³»ç»Ÿï¼Œåˆ™å¼ºåˆ¶å¯†ç å’Œè´¦å·å¯†ç ä¸€è‡´ï¼ˆæ—¢è·³è¿‡åé¢çš„å¯†ç éªŒè¯ç¯èŠ‚ï¼‰</span></span><br><span class="line"><span class="keyword">if</span>( intval($user[<span class="string">'fromsso'</span>]) == <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">$db_user[<span class="string">'passwd'</span>] = md5($user[<span class="string">'password'</span>]);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å…¶ä½™ä»£ç ä¸å˜...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Zabbixæ˜¯ä¸€ä¸ªè€ç‰Œçš„ç³»ç»Ÿç›‘æ§è½¯ä»¶ã€‚æ˜¯ä¸€ä¸ªé«˜åº¦é›†æˆçš„ç½‘ç»œç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥æä¾›ä¼ä¸šçº§çš„å¼€æºåˆ†å¸ƒå¼ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;Zabbixæ˜¯ä¸€ä¸ªåŸºäºWebç•Œé¢çš„ï¼Œæä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›‘æ§ä»¥åŠç½‘ç»œç›‘è§†åŠŸèƒ½çš„ä¼ä¸šçº§çš„å¼€æºè§£å†³æ–¹æ¡ˆã€‚èƒ½çµæ´»ç›‘è§†å„ç§ç½‘ç»œå‚æ•°ï¼Œä¿
      
    
    </summary>
    
    
      <category term="HTML/CSS/JS" scheme="http://blog.sqj.me/categories/HTML-CSS-JS/"/>
    
    
      <category term="SSO" scheme="http://blog.sqj.me/tags/SSO/"/>
    
      <category term="Zabbix" scheme="http://blog.sqj.me/tags/Zabbix/"/>
    
  </entry>
  
  <entry>
    <title>é…ç½®nginxå±è”½ç‰¹å®šIP/UAçš„è®¿é—®</title>
    <link href="http://blog.sqj.me/2019/how-to-ban-ip-or-ua-in-nginx/"/>
    <id>http://blog.sqj.me/2019/how-to-ban-ip-or-ua-in-nginx/</id>
    <published>2019-11-04T02:57:03.000Z</published>
    <updated>2019-11-12T08:21:09.058Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Nginxæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½Web/ProxyæœåŠ¡å™¨ã€‚æœ¬æ–‡å°†é…ç½®Nginxï¼Œæ¥å…è®¸ç‰¹å®šIPæ¥æºè®¿é—®ï¼Œå±è”½ç‰¹å®šUAï¼ˆUser-Agentï¼‰è®¿é—®ã€‚</p></blockquote><h3 id="å…è®¸-å±è”½IPçš„è®¿é—®"><a href="#å…è®¸-å±è”½IPçš„è®¿é—®" class="headerlink" title="å…è®¸/å±è”½IPçš„è®¿é—®"></a>å…è®¸/å±è”½IPçš„è®¿é—®</h3><p>åœ¨æ¥å…¥äº‘WAFåï¼Œé€šå¸¸è¦é™åˆ¶è®¿é—®çš„IPæ¥æºï¼ˆé€šå¸¸ç§°ä¸ºé™æºï¼‰ã€‚åœ¨Nginxä¸­ï¼Œèƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°é…ç½®ã€‚</p><h4 id="1ã€æ–°å¢ä¸€ä¸ªé™æºæ–‡ä»¶é…ç½®IPä¿¡æ¯ï¼Œæ–¹ä¾¿åç»­å¼•å…¥æ¯ä¸€ä¸ªç«™ç‚¹çš„é…ç½®æ–‡ä»¶ä¸­"><a href="#1ã€æ–°å¢ä¸€ä¸ªé™æºæ–‡ä»¶é…ç½®IPä¿¡æ¯ï¼Œæ–¹ä¾¿åç»­å¼•å…¥æ¯ä¸€ä¸ªç«™ç‚¹çš„é…ç½®æ–‡ä»¶ä¸­" class="headerlink" title="1ã€æ–°å¢ä¸€ä¸ªé™æºæ–‡ä»¶é…ç½®IPä¿¡æ¯ï¼Œæ–¹ä¾¿åç»­å¼•å…¥æ¯ä¸€ä¸ªç«™ç‚¹çš„é…ç½®æ–‡ä»¶ä¸­"></a>1ã€æ–°å¢ä¸€ä¸ªé™æºæ–‡ä»¶é…ç½®IPä¿¡æ¯ï¼Œæ–¹ä¾¿åç»­å¼•å…¥æ¯ä¸€ä¸ªç«™ç‚¹çš„é…ç½®æ–‡ä»¶ä¸­</h4><h4 id="2ã€é…ç½®IPç™½åå•"><a href="#2ã€é…ç½®IPç™½åå•" class="headerlink" title="2ã€é…ç½®IPç™½åå•"></a>2ã€é…ç½®IPç™½åå•</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  ç™½åå•IP</span></span><br><span class="line">allow 113.456.238.0/24;</span><br><span class="line">allow 106.142.25.0/24;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="3ã€é…ç½®å…¶ä½™IPç¦æ­¢è®¿é—®"><a href="#3ã€é…ç½®å…¶ä½™IPç¦æ­¢è®¿é—®" class="headerlink" title="3ã€é…ç½®å…¶ä½™IPç¦æ­¢è®¿é—®"></a>3ã€é…ç½®å…¶ä½™IPç¦æ­¢è®¿é—®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deny all;</span><br></pre></td></tr></table></figure><hr><h3 id="å±è”½ç‰¹å®šUAè®¿é—®æ¥æº"><a href="#å±è”½ç‰¹å®šUAè®¿é—®æ¥æº" class="headerlink" title="å±è”½ç‰¹å®šUAè®¿é—®æ¥æº"></a>å±è”½ç‰¹å®šUAè®¿é—®æ¥æº</h3><p>é€šè¿‡Nginxç›‘æµ‹ $http_user_agent ï¼Œåˆ¤æ–­æ˜¯å¦åŒ…å«ç‰¹å®šå­—ç¬¦æ¥è¿›è¡Œè¿‡æ»¤ã€‚æ¯”å¦‚å±è”½Awesomiumï¼Œå¯ç”¨å¦‚ä¸‹ä»£ç ã€‚~*ç¬¦å·ï¼Œæ ‡è¯†æ­£åˆ™åŒ¹é…æ—¶ï¼Œå¿½ç•¥å¤§å°å†™ã€‚</p><p>å½“åŒ¹é…åˆ°å¯¹åº”UAçš„æ—¶å€™ï¼Œè¿”å›404é”™è¯¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~* <span class="string">"Awesomium"</span>)&#123;</span><br><span class="line">     <span class="built_in">return</span> 404;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ‰€æœ‰ä»£ç ç»“æ„"><a href="#æ‰€æœ‰ä»£ç ç»“æ„" class="headerlink" title="æ‰€æœ‰ä»£ç ç»“æ„"></a>æ‰€æœ‰ä»£ç ç»“æ„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  å±è”½ UA</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~* <span class="string">"Awesomium"</span>)&#123;</span><br><span class="line">     <span class="built_in">return</span> 404;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#  ç™½åå•IP</span></span><br><span class="line">allow 113.456.238.0/24;</span><br><span class="line">allow 106.142.25.0/24;</span><br><span class="line">...</span><br><span class="line"><span class="comment">#  ç™½åå•IPç»“æŸ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  å±è”½å…¶å®ƒIPè®¿é—®æ¥æº</span></span><br><span class="line">deny all;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨Postmanè¿›è¡Œé…ç½®æµ‹è¯•"><a href="#ä½¿ç”¨Postmanè¿›è¡Œé…ç½®æµ‹è¯•" class="headerlink" title="ä½¿ç”¨Postmanè¿›è¡Œé…ç½®æµ‹è¯•"></a>ä½¿ç”¨Postmanè¿›è¡Œé…ç½®æµ‹è¯•</h3><h4 id="1ã€æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿”å›æ­£ç¡®çš„ä¿¡æ¯"><a href="#1ã€æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿”å›æ­£ç¡®çš„ä¿¡æ¯" class="headerlink" title="1ã€æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿”å›æ­£ç¡®çš„ä¿¡æ¯"></a>1ã€æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿”å›æ­£ç¡®çš„ä¿¡æ¯</h4><p><img src="http://q068kveb3.bkt.clouddn.com/image/postman-test-before-config.png" alt=""></p><h4 id="2ã€é…ç½®äº†å±è”½ä»£ç åï¼Œç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ã€‚"><a href="#2ã€é…ç½®äº†å±è”½ä»£ç åï¼Œç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ã€‚" class="headerlink" title="2ã€é…ç½®äº†å±è”½ä»£ç åï¼Œç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ã€‚"></a>2ã€é…ç½®äº†å±è”½ä»£ç åï¼Œç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ã€‚</h4><p><img src="http://q068kveb3.bkt.clouddn.com/image/postman-test-after-config.png" alt=""></p><hr><p>å±è”½è®¿é—®ç‰¹å®šçš„urlåœ°å€ï¼Œè¯·çœ‹ <a href="/2019/how-to-ban-particular-floder-in-nginx">å¦‚ä½•åœ¨Nginxä¸­å±è”½ç‰¹å®šçš„åœ°å€æˆ–æ–‡ä»¶å¤¹</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Nginxæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½Web/ProxyæœåŠ¡å™¨ã€‚æœ¬æ–‡å°†é…ç½®Nginxï¼Œæ¥å…è®¸ç‰¹å®šIPæ¥æºè®¿é—®ï¼Œå±è”½ç‰¹å®šUAï¼ˆUser-Agentï¼‰è®¿é—®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;å…è®¸-å±è”½IPçš„è®¿é—®&quot;&gt;&lt;a href=&quot;#å…è®¸-å±è”½IP
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Nginx" scheme="http://blog.sqj.me/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>linux centos è°ƒæ•´é…ç½® swap çš„æ–¹æ³•</title>
    <link href="http://blog.sqj.me/2019/linux-centos-swap-modify/"/>
    <id>http://blog.sqj.me/2019/linux-centos-swap-modify/</id>
    <published>2019-11-03T02:34:37.000Z</published>
    <updated>2019-11-12T08:21:21.806Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‘ç°Centosçš„swapåˆ†åŒºä¸è¶³ï¼Œè°ƒæ•´swapã€‚"><a href="#ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‘ç°Centosçš„swapåˆ†åŒºä¸è¶³ï¼Œè°ƒæ•´swapã€‚" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‘ç°Centosçš„swapåˆ†åŒºä¸è¶³ï¼Œè°ƒæ•´swapã€‚"></a>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‘ç°Centosçš„swapåˆ†åŒºä¸è¶³ï¼Œè°ƒæ•´swapã€‚</h3><p>1ã€æŸ¥çœ‹å†…å­˜æƒ…å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -m</span><br></pre></td></tr></table></figure><p><img src="http://q068kveb3.bkt.clouddn.com/image/free-m.png" alt=""></p><p>2ã€å¢åŠ swap</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/var/swap bs=1024 count=20480000</span><br><span class="line"></span><br><span class="line">mkswap /var/swap</span><br><span class="line"></span><br><span class="line">mkswap -f /var/swap</span><br><span class="line"></span><br><span class="line">swapon /var/swap</span><br></pre></td></tr></table></figure><p>3ã€å¢åŠ å¼€æœºé…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/fstab</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/swap               swap                    swap    defaults        0 0</span><br></pre></td></tr></table></figure><p>4ã€æŸ¥çœ‹é…ç½®åçš„æƒ…å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -h</span><br></pre></td></tr></table></figure><p><img src="http://q068kveb3.bkt.clouddn.com/image/free-m2.png" alt=""></p><p>5ã€ å¦‚æœä¸å†éœ€è¦swapï¼Œå¯ä»¥æ¸…ç†è¯¥åˆ†åŒº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapoff /var/swap</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‘ç°Centosçš„swapåˆ†åŒºä¸è¶³ï¼Œè°ƒæ•´swapã€‚&quot;&gt;&lt;a href=&quot;#ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‘ç°Centosçš„swapåˆ†åŒºä¸è¶³ï¼Œè°ƒæ•´swapã€‚&quot; class=&quot;headerlink&quot; title=&quot;ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‘ç°Centosçš„swapåˆ†åŒºä¸è¶³ï¼Œè°ƒæ•´swap
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Centos" scheme="http://blog.sqj.me/tags/Centos/"/>
    
  </entry>
  
  <entry>
    <title>Grafanaç®€å•OAuthè®¤è¯ï¼ˆè‡ªå»ºç®€æ˜“OAuth 2.0å®ç°Grafana SSOæ•´åˆï¼‰</title>
    <link href="http://blog.sqj.me/2019/grafana-oauth-simple/"/>
    <id>http://blog.sqj.me/2019/grafana-oauth-simple/</id>
    <published>2019-10-31T04:05:15.000Z</published>
    <updated>2019-11-01T07:03:32.013Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Grafanaèƒ½å¤Ÿä»¥è¾ƒä¸ºä¸°å¯Œçš„æ–¹å¼è¿›è¡Œå•ç‚¹ç™»å½•é›†æˆã€‚åœ¨  <a href="https://Grafana.com/docs/installation/configuration/" target="_blank" rel="noopener">https://Grafana.com/docs/installation/configuration/</a>  ä¸­æœ‰æ¯”è¾ƒå…¨é¢çš„æè¿°ã€‚</p><ul><li><a href="https://Grafana.com/docs/auth/overview/" target="_blank" rel="noopener">Authentication Overview</a> (anonymous access options, hide login and more)</li><li><a href="https://Grafana.com/docs/auth/google/" target="_blank" rel="noopener">Google OAuth</a> (auth.google)</li><li><a href="https://Grafana.com/docs/auth/github/" target="_blank" rel="noopener">GitHub OAuth</a> (auth.github)</li><li><a href="https://Grafana.com/docs/auth/gitlab/" target="_blank" rel="noopener">Gitlab OAuth</a> (auth.gitlab)</li><li><a href="https://Grafana.com/docs/auth/generic-OAuth/" target="_blank" rel="noopener">Generic OAuth</a> (auth.generic_OAuth, okta2, auth0, bitbucket, azure)</li><li><a href="https://Grafana.com/docs/auth/overview/" target="_blank" rel="noopener">Basic Authentication</a> (auth.basic)</li><li><a href="https://Grafana.com/docs/auth/ldap/" target="_blank" rel="noopener">LDAP Authentication</a> (auth.ldap)</li><li><a href="https://Grafana.com/docs/auth/auth-proxy/" target="_blank" rel="noopener">Auth Proxy</a> (auth.proxy)</li></ul></blockquote><p>ä½†æ˜¯å¦‚æœåŸæœ‰ç³»ç»Ÿæ— æ³•ä½¿ç”¨ä»¥ä¸Šæ–¹å¼è¿›è¡Œæ•´åˆï¼Œåˆä¸æƒ³ç›´æ¥å…è®¸åŒ¿åç™»å½•ï¼Œåˆ™å¯ä»¥åŸºäºOAuth 2.0çš„è®¤è¯é€»è¾‘ï¼Œå¼€å‘ä¸€ä¸ªç®€æ˜“çš„OAuthè®¤è¯æœåŠ¡ï¼Œå®ç°Grafanaçš„å•ç‚¹ç™»å½•ã€‚</p><p>ä»¥ä¸‹å†…å®¹åœ¨ <a href="https://smallpath.me/post/Grafana-with-sso" target="_blank" rel="noopener">https://smallpath.me/post/Grafana-with-sso</a> è·å¾—äº†å¾ˆå¤šå¸®åŠ©ã€‚</p><p>OAuth2 RFC6749 åŸç†å¯æŸ¥çœ‹  <a href="https://colobu.com/2017/04/28/OAuth2-rfc6749/" target="_blank" rel="noopener">https://colobu.com/2017/04/28/OAuth2-rfc6749/</a> </p><h3 id="OAuth-2-0è®¤è¯åŸºæœ¬é€»è¾‘"><a href="#OAuth-2-0è®¤è¯åŸºæœ¬é€»è¾‘" class="headerlink" title="OAuth 2.0è®¤è¯åŸºæœ¬é€»è¾‘"></a>OAuth 2.0è®¤è¯åŸºæœ¬é€»è¾‘</h3><h4 id="åè®®æµç¨‹"><a href="#åè®®æµç¨‹" class="headerlink" title="åè®®æµç¨‹"></a>åè®®æµç¨‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+--------+                               +---------------+</span><br><span class="line">|        |--(A)- Authorization Request -&gt;|   Resource    |</span><br><span class="line">|        |                               |     Owner     |</span><br><span class="line">|        |&lt;-(B)-- Authorization Grant ---|               |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |--(C)-- Authorization Grant --&gt;| Authorization |</span><br><span class="line">| Client |                               |     Server    |</span><br><span class="line">|        |&lt;-(D)----- Access Token -------|               |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |--(E)----- Access Token ------&gt;|    Resource   |</span><br><span class="line">|        |                               |     Server    |</span><br><span class="line">|        |&lt;-(F)--- Protected Resource ---|               |</span><br><span class="line">+--------+                               +---------------+</span><br></pre></td></tr></table></figure><p> å›¾ä¸­æ‰€ç¤ºçš„æŠ½è±¡OAuth 2.0æµç¨‹æè¿°äº†å››ä¸ªè§’è‰²ä¹‹é—´çš„äº¤äº’ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š </p><ul><li>ï¼ˆAï¼‰å®¢æˆ·ç«¯å‘ä»èµ„æºæ‰€æœ‰è€…è¯·æ±‚æˆæƒã€‚æˆæƒè¯·æ±‚å¯ä»¥ç›´æ¥å‘èµ„æºæ‰€æœ‰è€…å‘èµ·ï¼ˆå¦‚å›¾æ‰€ç¤ºï¼‰ï¼Œæˆ–è€…æ›´å¯å–çš„æ˜¯é€šè¿‡ä½œä¸ºä¸­ä»‹çš„æˆæƒæœåŠ¡å™¨é—´æ¥å‘èµ·ã€‚</li><li>ï¼ˆBï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æˆæƒè®¸å¯ï¼Œè¿™æ˜¯ä¸€ä¸ªä»£è¡¨èµ„æºæ‰€æœ‰è€…çš„æˆæƒçš„å‡­æ®ï¼Œä½¿ç”¨æœ¬è§„èŒƒä¸­å®šä¹‰çš„å››ç§è®¸å¯ç±»å‹ä¹‹ä¸€æˆ– è€…ä½¿ç”¨æ‰©å±•è®¸å¯ç±»å‹è¡¨ç¤ºã€‚æˆæƒè®¸å¯ç±»å‹å–å†³äºå®¢æˆ·ç«¯è¯·æ±‚æˆæƒæ‰€ä½¿ç”¨çš„æ–¹å¼ä»¥åŠæˆæƒæœåŠ¡å™¨æ”¯æŒçš„ç±»å‹ã€‚</li><li>ï¼ˆCï¼‰å®¢æˆ·ç«¯ä¸æˆæƒæœåŠ¡å™¨è¿›è¡Œèº«ä»½è®¤è¯å¹¶å‡ºç¤ºæˆæƒè®¸å¯è¯·æ±‚è®¿é—®ä»¤ç‰Œã€‚</li><li>ï¼ˆDï¼‰æˆæƒæœåŠ¡å™¨éªŒè¯å®¢æˆ·ç«¯èº«ä»½å¹¶éªŒè¯æˆæƒè®¸å¯ï¼Œè‹¥æœ‰æ•ˆåˆ™é¢å‘è®¿é—®ä»¤ç‰Œã€‚</li><li>ï¼ˆEï¼‰å®¢æˆ·ç«¯ä»èµ„æºæœåŠ¡å™¨è¯·æ±‚å—ä¿æŠ¤èµ„æºå¹¶å‡ºç¤ºè®¿é—®ä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯ã€‚</li><li>ï¼ˆFï¼‰èµ„æºæœåŠ¡å™¨éªŒè¯è®¿é—®ä»¤ç‰Œï¼Œè‹¥æœ‰æ•ˆåˆ™æ»¡è¶³è¯¥è¯·æ±‚ã€‚</li></ul><h3 id="ç®€æ˜“OAuthæœåŠ¡å¼€å‘"><a href="#ç®€æ˜“OAuthæœåŠ¡å¼€å‘" class="headerlink" title="ç®€æ˜“OAuthæœåŠ¡å¼€å‘"></a>ç®€æ˜“OAuthæœåŠ¡å¼€å‘</h3><h4 id="Grafanaé…ç½®"><a href="#Grafanaé…ç½®" class="headerlink" title="Grafanaé…ç½®"></a>Grafanaé…ç½®</h4><h5 id="1ã€é…ç½®ç»¼è¿°"><a href="#1ã€é…ç½®ç»¼è¿°" class="headerlink" title="1ã€é…ç½®ç»¼è¿°"></a>1ã€é…ç½®ç»¼è¿°</h5><p>Grafanaå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ Oktaã€Googleã€ldapã€Github ã€OneClick Loginç­‰è¿›è¡Œé›†æˆã€‚åœ¨å•ç‚¹ç™»å½•æ•´åˆå‰ï¼Œä¹Ÿè¯„ä¼°è¿‡ä¸è¿™äº›ç³»ç»Ÿå¯¹æ¥ã€‚åç»¼åˆè¯„ä¼°åï¼Œéƒ½å­˜åœ¨å„æ ·é—®é¢˜ã€‚</p><ol><li>éƒ¨åˆ†äº§å“éœ€è¦å¤–éƒ¨æœåŠ¡æ”¯æŒï¼Œå¦‚Googleã€Githubç­‰ã€‚å—åˆ°å¤–éƒ¨ç½‘ç»œç¯å¢ƒå½±å“è¾ƒå¤§ã€‚</li><li>å¯ä»¥ç§æœ‰åŒ–éƒ¨ç½²åœ°äº§å“ï¼Œå­˜åœ¨éƒ¨ç½²ã€å­¦ä¹ é…ç½®ã€ä¸ç°æœ‰è´¦å·/æœºæ„ç³»ç»Ÿæ•´åˆç­‰æˆæœ¬ã€‚</li></ol><p>ç»¼åˆè¯„ä¼°ä¸‹æ¥ï¼Œè¿˜æ˜¯é€šè¿‡Grafanaåœ°Generic OAuthæ–¹å¼ï¼Œé€šè¿‡å¼€å‘ä¸ç°æœ‰ç³»ç»Ÿæ•´åˆï¼Œåˆç¬¦åˆGrafana OAuth2.0 è¦æ±‚çš„å•ç‚¹ç™»å½•æœåŠ¡æ¯”è¾ƒæ–¹ä¾¿ã€‚</p><h5 id="2ã€é…ç½®"><a href="#2ã€é…ç½®" class="headerlink" title="2ã€é…ç½®"></a>2ã€é…ç½®</h5><p>Grafanaå•ç‚¹ç™»å½•é…ç½®ï¼Œä¸»è¦æœ‰3ä¸ªå‚æ•°ï¼Œ<strong>auth_urlã€token_urlã€api_url</strong>ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[auth.generic_OAuth]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">name</span> = åç§°</span><br><span class="line"><span class="comment">;allow_sign_up = true</span></span><br><span class="line"><span class="attr">client_id</span> = Grafana_info<span class="comment">;ç”¨äºä¼ é€’åˆ°auth_urlæ ‡è¯†ç³»ç»Ÿæ¥æº</span></span><br><span class="line"><span class="attr">client_secret</span> = some_secret<span class="comment">;ç”¨äºä¼ é€’åˆ°token_urlæ ‡è¯†ç³»ç»Ÿï¼Œå¯æš‚æ—¶å¿½ç•¥</span></span><br><span class="line"><span class="attr">scopes</span> = uname email<span class="comment">;æœç´¢è¿”å›ç”¨æˆ·æ•°æ®çš„æ¥æº</span></span><br><span class="line"><span class="comment">;email_attribute_name = email:primary</span></span><br><span class="line"><span class="comment">;email_attribute_path =</span></span><br><span class="line"><span class="attr">auth_url</span> = https://XXXXXXXX/OAuth2_simple/auth.php<span class="comment">;è®¤è¯ç¬¬ä¸€æ­¥çš„æˆæƒé¡µé¢</span></span><br><span class="line"><span class="attr">token_url</span> = https://XXXXXXXX/OAuth2_simple/token.php<span class="comment">;è®¤è¯ç¬¬äºŒæ­¥çš„è·å–tokené¡µé¢</span></span><br><span class="line"><span class="attr">api_url</span> = https://XXXXXXXX/OAuth2_simple/user.php<span class="comment">;è®¤è¯ç¬¬ä¸‰æ­¥çš„é€šè¿‡tokenè·å–ç”¨æˆ·ä¿¡æ¯é¡µé¢</span></span><br></pre></td></tr></table></figure><h5 id="3ã€é…ç½®è¯´æ˜"><a href="#3ã€é…ç½®è¯´æ˜" class="headerlink" title="3ã€é…ç½®è¯´æ˜"></a>3ã€é…ç½®è¯´æ˜</h5><p>ï¼ˆå‚è€ƒ<a href="https://smallpath.me/post/Grafana-with-sso" target="_blank" rel="noopener">https://smallpath.me/post/Grafana-with-sso</a> ï¼Œå¹¶è¿›è¡Œäº†è°ƒæ•´ï¼‰</p><p><strong>3.1 Grafana å‚æ•° auth_url</strong></p><p>auth_url æ˜¯ Generic-OAuth çš„ OAuth 2 æµç¨‹çš„ç¬¬ä¸€æ­¥ï¼ŒGrafana ä¼šåœ¨å‰ç«¯è·³è½¬åˆ° auth_url é‡Œå¡«å†™çš„åœ°å€ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªåœ°å€é‡Œåšçš„äº‹æƒ…æ˜¯ï¼š</p><ol><li><p>æ ¡éªŒclient_idï¼ˆæ˜¯å¦ä¸[auth.generic_OAuth]ä¸­é…ç½®ä¸€è‡´ï¼‰ï¼Œåˆ¤æ–­è·³è½¬è¿‡æ¥çš„ç³»ç»Ÿæ˜¯å¦æ˜¯Grafanaã€‚</p></li><li><p>auth_url éªŒè¯å½“å‰æµè§ˆå™¨è´¦æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•ï¼ˆsession/cookieç­‰ï¼‰ï¼Œåˆ™å¼•å¯¼ç”¨æˆ·è¿›è¡Œç™»å½•ã€‚</p></li><li><p>ç”±ä»¥ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œç”Ÿæˆ ${token} </p></li><li><p>æ ¹æ®Grafana è·³è½¬è¿‡æ¥çš„åœ°å€çš„ querystring ä¸­ä¼šå¸¦æœ‰ redirect_uri å’Œ state å‚æ•°ï¼Œæ„é€ è·³å›Grafanaçš„åœ°å€ã€‚æ„é€ åœ°å€ä¸ºï¼š </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redirect_uri?state=$&#123;state&#125;&amp;code=$&#123;token&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ${state}å‚æ•°ä¸€å®šæ˜¯Grafanaä¼ é€’è¿‡æ¥çš„å‚æ•°ï¼ŒåŸå°ä¸åŠ¨ä¼ é€’å›å»ã€‚</p></li></ol><p><strong>3.2 Grafana å‚æ•° token_url</strong></p><p>Grafanaçš„éªŒè¯åœ°å€ï¼ˆå…¶å®å°±æ˜¯ç¬¬ä¸€æ­¥æ‰€æ‹¼è£…è·³è½¬å›æ¥çš„åœ°å€ï¼‰æ‰§è¡Œä¸¤éƒ¨æ“ä½œã€‚</p><ol><li>éªŒè¯å›è°ƒè¿‡æ¥çš„${state}æ˜¯å¦æ­£ç¡®ã€‚</li><li>è·å–${code}å‚æ•°ï¼Œé€šè¿‡æœåŠ¡åå°ï¼ˆæ—¢ä¸é€šè¿‡æµè§ˆå™¨å‰å°ï¼Œæ‰€ä»¥å¦‚æœéƒ½æ˜¯å†…éƒ¨çš„è¯ï¼Œè¿™é‡Œå¯ä»¥é…ç½®ä¸ºå†…ç½‘åœ°å€ï¼Œç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼‰ï¼Œè°ƒç”¨ <strong>token_url</strong> åœ°å€ï¼Œè·å– access_tokenã€‚</li></ol><p>Grafanaå‘ <strong>token_url</strong> POSTæ•°æ®ï¼ˆåå°è°ƒç”¨ï¼‰ï¼šcodeã€grant_typeã€client_idã€client_secret</p><p><strong>token_url</strong> è·å¾—ä»¥ä¸Š4ä¸ªå‚æ•°åï¼Œå¯ä»¥æ ¹æ®ç³»ç»Ÿé€»è¾‘è¿›è¡Œå„ç§å¤„ç†ï¼Œè¿”å›</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"access_token"</span>: <span class="string">"$access_token"</span>, <span class="attr">"token_type"</span>: <span class="string">"SSO"</span>, <span class="attr">"refresh_token"</span>: <span class="string">"$code"</span>, <span class="attr">"expires_int"</span>: <span class="number">60000</span>&#125;</span><br></pre></td></tr></table></figure><p>Grafanaè·å¾— access_token</p><p><strong>3.3 Grafana å‚æ•° api_url</strong></p><p>è¿™æ˜¯æœ€åä¸€æ­¥ï¼ŒGrafanaæ ¹æ®è·å¾—çš„ access_tokenï¼Œ è°ƒç”¨ <strong>api_url</strong>  api_urlè¿”å›åŒ…å«ç”¨æˆ·æ•°æ®çš„jsonç»“æ„ã€‚</p><p>æ³¨æ„ï¼šè¿™é‡ŒGrafanaå°†Authorizationçš„ä¿¡æ¯ï¼ŒåŒ…å«åœ¨Requestçš„Headerä¸­ï¼Œä¸æ˜¯åœ¨Post/Getçš„å‚æ•°ã€‚ä»¥phpä¸ºä¾‹ï¼Œè·å–å‚æ•°ä¿¡æ¯ä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$Authorization = $_SERVER[<span class="string">"HTTP_AUTHORIZATION"</span>]; <span class="comment">//$header['Authorization'];</span></span><br><span class="line"><span class="comment">//echo $Authorization;</span></span><br><span class="line"></span><br><span class="line">$auth_arr = explode(<span class="string">' '</span>,$Authorization);<span class="comment">//åˆ‡åˆ†</span></span><br><span class="line">$token = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">if</span>( count($auth_arr) &gt;= <span class="number">2</span> )</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//error_log("key :".$auth_arr[1]);</span></span><br><span class="line">$token = $auth_arr[<span class="number">1</span>];<span class="comment">//è¿™ä¸ªå°±æ˜¯æˆæƒçš„access_token</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>api_urlè¿”å›</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"Email"</span>: <span class="string">"$email"</span>, <span class="attr">"Login"</span>: <span class="string">"$uname"</span>,<span class="attr">"Name"</span>: <span class="string">"$uname"</span>&#125;</span><br></pre></td></tr></table></figure><p>Grafanaä¼šæ ¹æ®å‚æ•°ä¸­çš„scopes é…ç½®ï¼Œæ¥è·å–æˆæƒçš„ç”¨æˆ·åã€‚</p><p>è¯¥ç”¨æˆ·åï¼Œå¿…é¡»æå‰åœ¨Grafanaä¸­å·²ç»æ³¨å†Œã€‚</p><p>è‡³æ­¤ï¼Œä¸€ä¸ªç®€æ˜“OAuth2.0çš„è®¤è¯å®Œæˆã€‚è¿™ç§æ–¹å¼ä¸ä½†é€‚ç”¨äºGrafanaï¼Œä¹Ÿé€‚ç”¨äºå…¶å®ƒä½¿ç”¨OAuth 2.0æ•´åˆçš„ç¬¬ä¸‰æ–¹ç³»ç»Ÿã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Grafanaèƒ½å¤Ÿä»¥è¾ƒä¸ºä¸°å¯Œçš„æ–¹å¼è¿›è¡Œå•ç‚¹ç™»å½•é›†æˆã€‚åœ¨  &lt;a href=&quot;https://Grafana.com/docs/installation/configuration/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;h
      
    
    </summary>
    
    
      <category term="HTML/CSS/JS" scheme="http://blog.sqj.me/categories/HTML-CSS-JS/"/>
    
    
      <category term="Grafana" scheme="http://blog.sqj.me/tags/Grafana/"/>
    
      <category term="OAuth" scheme="http://blog.sqj.me/tags/OAuth/"/>
    
      <category term="SSO" scheme="http://blog.sqj.me/tags/SSO/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸ç”¨å‘½ä»¤</title>
    <link href="http://blog.sqj.me/2019/common-script/"/>
    <id>http://blog.sqj.me/2019/common-script/</id>
    <published>2019-10-30T01:55:54.000Z</published>
    <updated>2019-11-13T09:59:37.325Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>-= è·å–å½“å‰ç›®å½•ä¸‹ï¼Œå„æ–‡ä»¶å¤¹çš„å¤§å° =-</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">du -h --max-depth=1 ./</span><br></pre></td></tr></table></figure><p>-= Centosä¸‹æŸ¥çœ‹å†…å­˜å ç”¨æƒ…å†µçš„æ–¹æ³• =-</p><p><a href="/2019/methods-to-get-memory-usage/">Centosä¸‹æŸ¥çœ‹å†…å­˜å ç”¨çš„æ–¹æ³•topã€freeã€ps</a></p><p>-= Centos ç½‘ç»œç›¸å…³å‘½ä»¤ =-</p><p><a href="/2019/network-script/">Centoså¸¸ç”¨ç½‘ç»œè„šæœ¬</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Linux&quot;&gt;&lt;a href=&quot;#Linux&quot; class=&quot;headerlink&quot; title=&quot;Linux&quot;&gt;&lt;/a&gt;Linux&lt;/h3&gt;&lt;p&gt;-= è·å–å½“å‰ç›®å½•ä¸‹ï¼Œå„æ–‡ä»¶å¤¹çš„å¤§å° =-&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;
      
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="http://blog.sqj.me/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Centos" scheme="http://blog.sqj.me/tags/Centos/"/>
    
  </entry>
  
  <entry>
    <title>é…ç½®Grafanaçš„Panelåœ°å€ï¼Œå®ç°ç‚¹å‡»å›¾è¡¨åè·³è½¬åˆ°å¦ä¸€ä¸ªdashboard/Url</title>
    <link href="http://blog.sqj.me/2019/a-way-to-set-grafana-panel-links/"/>
    <id>http://blog.sqj.me/2019/a-way-to-set-grafana-panel-links/</id>
    <published>2019-10-28T15:03:28.000Z</published>
    <updated>2019-10-30T05:35:23.706Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é…ç½®Grafanaçš„Panelåœ°å€ï¼Œå®ç°ç‚¹å‡»å›¾è¡¨åè·³è½¬åˆ°å¦ä¸€ä¸ªdashboard"><a href="#é…ç½®Grafanaçš„Panelåœ°å€ï¼Œå®ç°ç‚¹å‡»å›¾è¡¨åè·³è½¬åˆ°å¦ä¸€ä¸ªdashboard" class="headerlink" title="é…ç½®Grafanaçš„Panelåœ°å€ï¼Œå®ç°ç‚¹å‡»å›¾è¡¨åè·³è½¬åˆ°å¦ä¸€ä¸ªdashboard"></a>é…ç½®Grafanaçš„Panelåœ°å€ï¼Œå®ç°ç‚¹å‡»å›¾è¡¨åè·³è½¬åˆ°å¦ä¸€ä¸ªdashboard</h3><p>Grafanaæœ‰3ä¸ªåœ°æ–¹å¯ä»¥é…ç½®è·³è½¬é“¾æ¥</p><ol><li>dashboardå±‚æ¬¡ï¼Œåœ¨dashboardçš„settingså¯ä»¥é…ç½®Linksã€‚</li><li>æ¯ä¸€ä¸ªPanelçš„<strong>data links</strong>ã€‚</li><li>æ¯ä¸€ä¸ªPanelçš„<strong>panel links</strong>ã€‚</li></ol><p><img src="http://q068kveb3.bkt.clouddn.com/image/awaytosetlinks1.png" alt="åœ¨dashboardçš„Settings-&gt;Linksä¸­é…ç½®é“¾æ¥"></p><p><img src="http://q068kveb3.bkt.clouddn.com/image/awaytosetlinks2.png" alt="åœ¨Panelä¸­é…ç½®data links"></p><p><img src="http://q068kveb3.bkt.clouddn.com/image/awaytosetlinks3.png" alt="åœ¨Panelä¸­é…ç½®panel links"></p><p>åœ¨è¿™ä¸‰ä¸ªåœ°æ–¹éƒ½èƒ½å¤Ÿå®ç°ç‚¹å‡»é“¾æ¥è·³è½¬åˆ°å¦å¤–çš„é¡µé¢ã€‚</p><h3 id="ä¼ å‚"><a href="#ä¼ å‚" class="headerlink" title="ä¼ å‚"></a>ä¼ å‚</h3><p>åœ¨æ·»åŠ é“¾æ¥æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç»å¯¹åœ°å€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¼ é€’å˜é‡å‚æ•°ï¼Œå®ç°é“¾æ¥çš„åŠ¨æ€è·³è½¬</p><p>ä¸»è¦å‚æ•°å¦‚ä¸‹</p><table><thead><tr><th>åç§°</th><th>ä¸¾ä¾‹</th><th>ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td>${é…ç½®çš„dashboardå˜é‡}</td><td>å¦‚$group,$hostç­‰</td><td>è¿™äº›å˜é‡éœ€è¦åœ¨dashboardçš„settingsçš„å˜é‡é‡Œé¢è®¾ç½®</td></tr><tr><td>${__url_time_range}</td><td>æ—¶é—´èŒƒå›´</td><td>${<strong>url_time_range} ${</strong>from} ${__to}</td></tr><tr><td>${__series.name}</td><td>æ•°æ®åˆ—çš„åç§°</td><td>åªåœ¨<strong>data links</strong>ä¸­æœ‰</td></tr><tr><td>${__field.name}</td><td>æ•°æ®åˆ—çš„åç§°</td><td>åªåœ¨<strong>data links</strong>ä¸­æœ‰</td></tr><tr><td>${__value.numeric}</td><td>å›¾è¡¨çš„æ•°å€¼</td><td>åªåœ¨<strong>data links</strong>ä¸­æœ‰ï¼Œå¯ä»¥æ˜¯å­—ç¬¦/æ•°å­—/åŸå€¼/è®¡ç®—å€¼</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><p><strong>æ³¨æ„ï¼š</strong>åœ¨å®è·µä¸­å‘ç°ï¼Œå¦‚æœdashboardçš„å˜é‡ï¼Œå…è®¸ä½¿ç”¨<strong>ALL</strong>çš„æ—¶å€™ï¼Œåªæœ‰åœ¨<strong>panel links</strong>ä¸­é…ç½®çš„urlèƒ½å¤Ÿå‡†ç¡®æŠ“å–å½“å‰å›¾è¡¨çš„å˜é‡å€¼ã€‚å¦åˆ™ï¼Œä¼šå°†å˜é‡çš„æ‰€æœ‰å€¼ï¼Œéƒ½ä¼šè¢«ä¼ é€åˆ°è·³è½¬é“¾æ¥ä¸­ï¼Œå¯¼è‡´ç›®æ ‡urlåœ¨è·å–å‚æ•°çš„æ—¶å€™ä¸æ­£ç¡®ã€‚</p><h3 id="è·³è½¬åˆ°Dashboard"><a href="#è·³è½¬åˆ°Dashboard" class="headerlink" title="è·³è½¬åˆ°Dashboard"></a>è·³è½¬åˆ°Dashboard</h3><p>è·³è½¬åˆ°Dashboardæ˜¯ï¼Œç½‘ä¸Šçš„è¯´æ˜ä¸€ç›´è¯´çš„ä¸å¤Ÿé€å½»ã€‚æœ€ç®€å•çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>1ã€è¿›å…¥éœ€è¦è·³è½¬çš„Dashboardï¼Œå¤åˆ¶æµè§ˆå™¨å‰é¢ä¸€æ®µ<br><img src="http://q068kveb3.bkt.clouddn.com/image/awaytosetlinks4.png" alt="å¤åˆ¶dashboardé“¾æ¥åœ°å€"></p><p>2ã€è¿™æ®µåœ°å€å‰é¢ä¸€æ®µï¼Œå°±æ˜¯Dashboardçš„åœ°å€ï¼Œå°†è¿™æ®µé“¾æ¥åœ°å€ï¼Œå¤åˆ¶åˆ°Linksé‡Œé¢ï¼Œé…ç½®å³å¯ã€‚</p><p>3ã€åŠ ä¸Šé€‚å½“çš„å‚æ•°ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;é…ç½®Grafanaçš„Panelåœ°å€ï¼Œå®ç°ç‚¹å‡»å›¾è¡¨åè·³è½¬åˆ°å¦ä¸€ä¸ªdashboard&quot;&gt;&lt;a href=&quot;#é…ç½®Grafanaçš„Panelåœ°å€ï¼Œå®ç°ç‚¹å‡»å›¾è¡¨åè·³è½¬åˆ°å¦ä¸€ä¸ªdashboard&quot; class=&quot;headerlink&quot; title=&quot;é…ç½®Grafanaçš„Pa
      
    
    </summary>
    
    
      <category term="HTML/CSS/JS" scheme="http://blog.sqj.me/categories/HTML-CSS-JS/"/>
    
    
      <category term="Grafana" scheme="http://blog.sqj.me/tags/Grafana/"/>
    
  </entry>
  
  <entry>
    <title>è®¾ç½®githubæ­£ç¡®çš„Repository nameé¿å…404é”™è¯¯</title>
    <link href="http://blog.sqj.me/2019/set-correct-name-to-fix-github-404/"/>
    <id>http://blog.sqj.me/2019/set-correct-name-to-fix-github-404/</id>
    <published>2019-10-24T08:50:00.000Z</published>
    <updated>2019-10-30T05:34:46.853Z</updated>
    
    <content type="html"><![CDATA[<p>ç°åœ¨ä¸€ä¸ªå¾ˆçƒ­é—¨çš„åšå®¢æ–¹å¼ï¼Œå°±æ˜¯åœ¨githubä¸Šå»ºGithub Pagesã€‚</p><p>åœ¨åˆ›å»ºGithubçš„ä»“åº“ï¼ˆResposityï¼‰ï¼Œå¹¶ä¸”ä¸Šä¼ Hexoé¡µé¢åï¼Œé¡µé¢æ€»æ˜¯404ã€‚</p><p><img src="http://q068kveb3.bkt.clouddn.com/image/1571907461817.png" alt="1571907461817"></p><p>åœ¨ç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹ä¸­ï¼Œéƒ½å¿½ç•¥äº†ä¸€ç‚¹ï¼Œå°±æ˜¯æ­£ç¡®è®¾ç½®githubä»“åº“çš„åå­—ã€‚</p><p><strong>å¦‚æœè¦è®¾ç½®Github Pagesï¼Œä»“åº“çš„åå­—ï¼Œå¿…é¡»æ˜¯ç”¨æˆ·åã€‚æ‰èƒ½å‡ºç°å½¢å¦‚ <u>username.github.io</u> çš„è®¿é—®æ–¹å¼ã€‚</strong></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œçš„ä»“åº“åç§°ä¹Ÿä¸èƒ½éšä¾¿å–å¾—ã€‚</p><hr><p>æ­£ç¡®è®¾ç½®åï¼Œåœ¨Githubçš„â€œSettingsâ€é‡Œé¢ï¼Œå°†ç›´æ¥æ˜¾ç¤ºå‡ºå¯è®¿é—®çš„åœ°å€ã€‚</p><p><img src="http://q068kveb3.bkt.clouddn.com/image/1571907855052.png" alt="1571907855052"></p><p>é…ç½®å®Œæ¯•åï¼Œå½¢æˆå¦‚ä¸‹çš„è®¾ç½®ï¼Œæ³¨æ„ä»“åº“å‰ç¼€éœ€è¦å’Œç”¨æˆ·åä¸€è‡´ã€‚</p><p><img src="http://q068kveb3.bkt.clouddn.com/image/githubname-settings.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç°åœ¨ä¸€ä¸ªå¾ˆçƒ­é—¨çš„åšå®¢æ–¹å¼ï¼Œå°±æ˜¯åœ¨githubä¸Šå»ºGithub Pagesã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åˆ›å»ºGithubçš„ä»“åº“ï¼ˆResposityï¼‰ï¼Œå¹¶ä¸”ä¸Šä¼ Hexoé¡µé¢åï¼Œé¡µé¢æ€»æ˜¯404ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://q068kveb3.bkt.clouddn.c
      
    
    </summary>
    
    
      <category term="HTML/CSS/JS" scheme="http://blog.sqj.me/categories/HTML-CSS-JS/"/>
    
    
      <category term="Hexo" scheme="http://blog.sqj.me/tags/Hexo/"/>
    
  </entry>
  
</feed>
